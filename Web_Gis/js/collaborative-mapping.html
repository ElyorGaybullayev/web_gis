<!DOCTYPE html>
<html lang="" xml:lang="">

<!-- Mirrored from 132.72.155.230:3838/js/collaborative-mapping.html by HTTrack Website Copier/3.x [XR&CO'2014], Mon, 10 Jan 2022 06:45:29 GMT -->
<!-- Added by HTTrack --><meta http-equiv="content-type" content="text/html;charset=UTF-8" /><!-- /Added by HTTrack -->
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Chapter 13 Collaborative Mapping | Introduction to Web Mapping</title>
  <meta name="description" content="Chapter 13 Collaborative Mapping | Introduction to Web Mapping" />
  <meta name="generator" content="bookdown 0.22 and GitBook 2.6.7" />

  <meta property="og:title" content="Chapter 13 Collaborative Mapping | Introduction to Web Mapping" />
  <meta property="og:type" content="book" />
  
  
  <meta property="og:description" content="Chapter 13 Collaborative Mapping | Introduction to Web Mapping" />
  

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Chapter 13 Collaborative Mapping | Introduction to Web Mapping" />
  
  <meta name="twitter:description" content="Chapter 13 Collaborative Mapping | Introduction to Web Mapping" />
  

<meta name="author" content="Michael Dorman" />



  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  <link rel="shortcut icon" href="favicon.ico" type="image/x-icon" />
<link rel="prev" href="client-side-geoprocessing.html"/>
<link rel="next" href="associated-files.html"/>
<script src="libs/header-attrs/header-attrs.js"></script>
<script src="libs/jquery/jquery.min.js"></script>
<link href="libs/gitbook/css/style.css" rel="stylesheet" />
<link href="libs/gitbook/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook/css/plugin-clipboard.css" rel="stylesheet" />









<link href="libs/anchor-sections/anchor-sections.css" rel="stylesheet" />
<script src="libs/anchor-sections/anchor-sections.js"></script>
<!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-134641614-1"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-134641614-1');
</script>



<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<style type="text/css">
/* Used with Pandoc 2.11+ new --citeproc when CSL is used */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
}
.hanging div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}
</style>

<link rel="stylesheet" href="css/style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<a href="index.html"><img width="90%" style="margin: 5% 5% 0% 5%" src="images/BGUsig3E.svg"></a>

<li class="divider"></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>Preface</a>
<ul>
<li class="chapter" data-level="0.1" data-path="index.html"><a href="index.html#what-is-web-mapping"><i class="fa fa-check"></i><b>0.1</b> What is web mapping?</a></li>
<li class="chapter" data-level="0.2" data-path="index.html"><a href="index.html#what-is-javascript"><i class="fa fa-check"></i><b>0.2</b> What is JavaScript?</a></li>
<li class="chapter" data-level="0.3" data-path="index.html"><a href="index.html#why-use-javascript-for-web-mapping"><i class="fa fa-check"></i><b>0.3</b> Why use JavaScript for web mapping?</a></li>
<li class="chapter" data-level="0.4" data-path="index.html"><a href="index.html#learning-objectives"><i class="fa fa-check"></i><b>0.4</b> Learning objectives</a></li>
<li class="chapter" data-level="0.5" data-path="index.html"><a href="index.html#software"><i class="fa fa-check"></i><b>0.5</b> Software</a></li>
<li class="chapter" data-level="0.6" data-path="index.html"><a href="index.html#background-knowledge"><i class="fa fa-check"></i><b>0.6</b> Background knowledge</a></li>
<li class="chapter" data-level="0.7" data-path="index.html"><a href="index.html#online-version"><i class="fa fa-check"></i><b>0.7</b> Online version</a></li>
<li class="chapter" data-level="0.8" data-path="index.html"><a href="index.html#acknowledgments"><i class="fa fa-check"></i><b>0.8</b> Acknowledgments</a></li>
</ul></li>
<li class="part"><span><b>I Introduction to Web Technologies</b></span></li>
<li class="chapter" data-level="1" data-path="html.html"><a href="html.html"><i class="fa fa-check"></i><b>1</b> HTML</a>
<ul>
<li class="chapter" data-level="1.1" data-path="html.html"><a href="html.html#introduction"><i class="fa fa-check"></i><b>1.1</b> Introduction</a></li>
<li class="chapter" data-level="1.2" data-path="html.html"><a href="html.html#how-do-people-access-the-web"><i class="fa fa-check"></i><b>1.2</b> How do people access the web?</a>
<ul>
<li class="chapter" data-level="1.2.1" data-path="html.html"><a href="html.html#web-browsers"><i class="fa fa-check"></i><b>1.2.1</b> Web browsers</a></li>
<li class="chapter" data-level="1.2.2" data-path="html.html"><a href="html.html#web-servers"><i class="fa fa-check"></i><b>1.2.2</b> Web servers</a></li>
</ul></li>
<li class="chapter" data-level="1.3" data-path="html.html"><a href="html.html#web-pages"><i class="fa fa-check"></i><b>1.3</b> Web pages</a></li>
<li class="chapter" data-level="1.4" data-path="html.html"><a href="html.html#text-editors"><i class="fa fa-check"></i><b>1.4</b> Text editors</a></li>
<li class="chapter" data-level="1.5" data-path="html.html"><a href="html.html#what-is-html"><i class="fa fa-check"></i><b>1.5</b> What is HTML?</a>
<ul>
<li class="chapter" data-level="1.5.1" data-path="html.html"><a href="html.html#overview-html"><i class="fa fa-check"></i><b>1.5.1</b> Overview</a></li>
<li class="chapter" data-level="1.5.2" data-path="html.html"><a href="html.html#html-comments"><i class="fa fa-check"></i><b>1.5.2</b> HTML comments</a></li>
<li class="chapter" data-level="1.5.3" data-path="html.html"><a href="html.html#block-vs-inline"><i class="fa fa-check"></i><b>1.5.3</b> Block vs. inline</a></li>
</ul></li>
<li class="chapter" data-level="1.6" data-path="html.html"><a href="html.html#common-html-elements"><i class="fa fa-check"></i><b>1.6</b> Common HTML elements</a>
<ul>
<li class="chapter" data-level="1.6.1" data-path="html.html"><a href="html.html#html-element-types"><i class="fa fa-check"></i><b>1.6.1</b> HTML element types</a></li>
<li class="chapter" data-level="1.6.2" data-path="html.html"><a href="html.html#html-structure"><i class="fa fa-check"></i><b>1.6.2</b> Structure</a></li>
<li class="chapter" data-level="1.6.3" data-path="html.html"><a href="html.html#title-and-metadata"><i class="fa fa-check"></i><b>1.6.3</b> Title and metadata</a></li>
<li class="chapter" data-level="1.6.4" data-path="html.html"><a href="html.html#styling-and-scripts"><i class="fa fa-check"></i><b>1.6.4</b> Styling and scripts</a></li>
<li class="chapter" data-level="1.6.5" data-path="html.html"><a href="html.html#headings-and-paragraphs"><i class="fa fa-check"></i><b>1.6.5</b> Headings and paragraphs</a></li>
<li class="chapter" data-level="1.6.6" data-path="html.html"><a href="html.html#font-formatting"><i class="fa fa-check"></i><b>1.6.6</b> Font formatting</a></li>
<li class="chapter" data-level="1.6.7" data-path="html.html"><a href="html.html#spacing"><i class="fa fa-check"></i><b>1.6.7</b> Spacing</a></li>
<li class="chapter" data-level="1.6.8" data-path="html.html"><a href="html.html#html-lists"><i class="fa fa-check"></i><b>1.6.8</b> Lists</a></li>
<li class="chapter" data-level="1.6.9" data-path="html.html"><a href="html.html#html-links"><i class="fa fa-check"></i><b>1.6.9</b> Links</a></li>
<li class="chapter" data-level="1.6.10" data-path="html.html"><a href="html.html#images"><i class="fa fa-check"></i><b>1.6.10</b> Images</a></li>
<li class="chapter" data-level="1.6.11" data-path="html.html"><a href="html.html#tables"><i class="fa fa-check"></i><b>1.6.11</b> Tables</a></li>
<li class="chapter" data-level="1.6.12" data-path="html.html"><a href="html.html#grouping"><i class="fa fa-check"></i><b>1.6.12</b> Grouping</a></li>
<li class="chapter" data-level="1.6.13" data-path="html.html"><a href="html.html#input-elements"><i class="fa fa-check"></i><b>1.6.13</b> Input elements</a></li>
</ul></li>
<li class="chapter" data-level="1.7" data-path="html.html"><a href="html.html#id-class-and-style-attributes"><i class="fa fa-check"></i><b>1.7</b> <code>id</code>, <code>class</code>, and <code>style</code> attributes</a>
<ul>
<li class="chapter" data-level="1.7.1" data-path="html.html"><a href="html.html#overview-id-class-and-style-attributes"><i class="fa fa-check"></i><b>1.7.1</b> Overview</a></li>
<li class="chapter" data-level="1.7.2" data-path="html.html"><a href="html.html#id"><i class="fa fa-check"></i><b>1.7.2</b> <code>id</code></a></li>
<li class="chapter" data-level="1.7.3" data-path="html.html"><a href="html.html#html-class"><i class="fa fa-check"></i><b>1.7.3</b> <code>class</code></a></li>
<li class="chapter" data-level="1.7.4" data-path="html.html"><a href="html.html#style-2"><i class="fa fa-check"></i><b>1.7.4</b> <code>style</code></a></li>
</ul></li>
<li class="chapter" data-level="1.8" data-path="html.html"><a href="html.html#code-layout"><i class="fa fa-check"></i><b>1.8</b> Code layout</a></li>
<li class="chapter" data-level="1.9" data-path="html.html"><a href="html.html#inspecting-elements"><i class="fa fa-check"></i><b>1.9</b> Inspecting elements</a></li>
<li class="chapter" data-level="1.10" data-path="html.html"><a href="html.html#exercise"><i class="fa fa-check"></i><b>1.10</b> Exercise</a></li>
</ul></li>
<li class="chapter" data-level="2" data-path="css.html"><a href="css.html"><i class="fa fa-check"></i><b>2</b> CSS</a>
<ul>
<li class="chapter" data-level="2.1" data-path="css.html"><a href="css.html#introduction-1"><i class="fa fa-check"></i><b>2.1</b> Introduction</a></li>
<li class="chapter" data-level="2.2" data-path="css.html"><a href="css.html#what-is-css"><i class="fa fa-check"></i><b>2.2</b> What is CSS?</a></li>
<li class="chapter" data-level="2.3" data-path="css.html"><a href="css.html#css-rules"><i class="fa fa-check"></i><b>2.3</b> CSS rules</a></li>
<li class="chapter" data-level="2.4" data-path="css.html"><a href="css.html#css-selectors"><i class="fa fa-check"></i><b>2.4</b> CSS selectors</a>
<ul>
<li class="chapter" data-level="2.4.1" data-path="css.html"><a href="css.html#overview-css-selectors"><i class="fa fa-check"></i><b>2.4.1</b> Overview</a></li>
<li class="chapter" data-level="2.4.2" data-path="css.html"><a href="css.html#type-selector"><i class="fa fa-check"></i><b>2.4.2</b> Type selector</a></li>
<li class="chapter" data-level="2.4.3" data-path="css.html"><a href="css.html#class-selector"><i class="fa fa-check"></i><b>2.4.3</b> Class selector</a></li>
<li class="chapter" data-level="2.4.4" data-path="css.html"><a href="css.html#id-selector"><i class="fa fa-check"></i><b>2.4.4</b> ID selector</a></li>
<li class="chapter" data-level="2.4.5" data-path="css.html"><a href="css.html#descendant-selector"><i class="fa fa-check"></i><b>2.4.5</b> Descendant selector</a></li>
</ul></li>
<li class="chapter" data-level="2.5" data-path="css.html"><a href="css.html#css-conflicts"><i class="fa fa-check"></i><b>2.5</b> CSS conflicts</a></li>
<li class="chapter" data-level="2.6" data-path="css.html"><a href="css.html#css-inheritance"><i class="fa fa-check"></i><b>2.6</b> CSS inheritance</a></li>
<li class="chapter" data-level="2.7" data-path="css.html"><a href="css.html#linking-css-to-html"><i class="fa fa-check"></i><b>2.7</b> Linking CSS to HTML</a>
<ul>
<li class="chapter" data-level="2.7.1" data-path="css.html"><a href="css.html#methods-for-linking-css"><i class="fa fa-check"></i><b>2.7.1</b> Methods for linking CSS</a></li>
<li class="chapter" data-level="2.7.2" data-path="css.html"><a href="css.html#inline-css"><i class="fa fa-check"></i><b>2.7.2</b> Inline CSS</a></li>
<li class="chapter" data-level="2.7.3" data-path="css.html"><a href="css.html#embedded-css"><i class="fa fa-check"></i><b>2.7.3</b> Embedded CSS</a></li>
<li class="chapter" data-level="2.7.4" data-path="css.html"><a href="css.html#external-css"><i class="fa fa-check"></i><b>2.7.4</b> External CSS</a></li>
</ul></li>
<li class="chapter" data-level="2.8" data-path="css.html"><a href="css.html#css-properties"><i class="fa fa-check"></i><b>2.8</b> CSS properties</a>
<ul>
<li class="chapter" data-level="2.8.1" data-path="css.html"><a href="css.html#overview-css-properties"><i class="fa fa-check"></i><b>2.8.1</b> Overview</a></li>
<li class="chapter" data-level="2.8.2" data-path="css.html"><a href="css.html#color"><i class="fa fa-check"></i><b>2.8.2</b> Color</a></li>
<li class="chapter" data-level="2.8.3" data-path="css.html"><a href="css.html#text"><i class="fa fa-check"></i><b>2.8.3</b> Text</a></li>
<li class="chapter" data-level="2.8.4" data-path="css.html"><a href="css.html#boxes"><i class="fa fa-check"></i><b>2.8.4</b> Boxes</a></li>
</ul></li>
<li class="chapter" data-level="2.9" data-path="css.html"><a href="css.html#hurricane-scale"><i class="fa fa-check"></i><b>2.9</b> Hurricane scale example</a>
<ul>
<li class="chapter" data-level="2.9.1" data-path="css.html"><a href="css.html#html-contents"><i class="fa fa-check"></i><b>2.9.1</b> HTML contents</a></li>
<li class="chapter" data-level="2.9.2" data-path="css.html"><a href="css.html#css-styling"><i class="fa fa-check"></i><b>2.9.2</b> CSS styling</a></li>
</ul></li>
<li class="chapter" data-level="2.10" data-path="css.html"><a href="css.html#example-map-description"><i class="fa fa-check"></i><b>2.10</b> Map description example</a>
<ul>
<li class="chapter" data-level="2.10.1" data-path="css.html"><a href="css.html#html-contents-1"><i class="fa fa-check"></i><b>2.10.1</b> HTML contents</a></li>
<li class="chapter" data-level="2.10.2" data-path="css.html"><a href="css.html#example-map-description-box-position"><i class="fa fa-check"></i><b>2.10.2</b> CSS styling: box position</a></li>
<li class="chapter" data-level="2.10.3" data-path="css.html"><a href="css.html#css-styling-final-touches"><i class="fa fa-check"></i><b>2.10.3</b> CSS styling: final touches</a></li>
<li class="chapter" data-level="2.10.4" data-path="css.html"><a href="css.html#adding-map-in-the-background"><i class="fa fa-check"></i><b>2.10.4</b> Adding map in the background</a></li>
</ul></li>
<li class="chapter" data-level="2.11" data-path="css.html"><a href="css.html#exercise-1"><i class="fa fa-check"></i><b>2.11</b> Exercise</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="javascript-basics.html"><a href="javascript-basics.html"><i class="fa fa-check"></i><b>3</b> JavaScript Basics</a>
<ul>
<li class="chapter" data-level="3.1" data-path="javascript-basics.html"><a href="javascript-basics.html#introduction-2"><i class="fa fa-check"></i><b>3.1</b> Introduction</a></li>
<li class="chapter" data-level="3.2" data-path="javascript-basics.html"><a href="javascript-basics.html#what-is-javascript-1"><i class="fa fa-check"></i><b>3.2</b> What is JavaScript?</a></li>
<li class="chapter" data-level="3.3" data-path="javascript-basics.html"><a href="javascript-basics.html#client-side-vs.-server-side"><i class="fa fa-check"></i><b>3.3</b> Client-side vs. server-side</a></li>
<li class="chapter" data-level="3.4" data-path="javascript-basics.html"><a href="javascript-basics.html#the-javascript-console"><i class="fa fa-check"></i><b>3.4</b> The JavaScript console</a></li>
<li class="chapter" data-level="3.5" data-path="javascript-basics.html"><a href="javascript-basics.html#assignment"><i class="fa fa-check"></i><b>3.5</b> Assignment</a></li>
<li class="chapter" data-level="3.6" data-path="javascript-basics.html"><a href="javascript-basics.html#data-types"><i class="fa fa-check"></i><b>3.6</b> Data types</a>
<ul>
<li class="chapter" data-level="3.6.1" data-path="javascript-basics.html"><a href="javascript-basics.html#overview-data-types"><i class="fa fa-check"></i><b>3.6.1</b> Overview</a></li>
<li class="chapter" data-level="3.6.2" data-path="javascript-basics.html"><a href="javascript-basics.html#primitive-data-types"><i class="fa fa-check"></i><b>3.6.2</b> Primitive data types</a></li>
<li class="chapter" data-level="3.6.3" data-path="javascript-basics.html"><a href="javascript-basics.html#objects-data-type"><i class="fa fa-check"></i><b>3.6.3</b> Objects</a></li>
<li class="chapter" data-level="3.6.4" data-path="javascript-basics.html"><a href="javascript-basics.html#checking-type-of-variables"><i class="fa fa-check"></i><b>3.6.4</b> Checking type of variables</a></li>
</ul></li>
<li class="chapter" data-level="3.7" data-path="javascript-basics.html"><a href="javascript-basics.html#functions"><i class="fa fa-check"></i><b>3.7</b> Functions</a></li>
<li class="chapter" data-level="3.8" data-path="javascript-basics.html"><a href="javascript-basics.html#methods"><i class="fa fa-check"></i><b>3.8</b> Methods</a>
<ul>
<li class="chapter" data-level="3.8.1" data-path="javascript-basics.html"><a href="javascript-basics.html#what-are-methods"><i class="fa fa-check"></i><b>3.8.1</b> What are methods?</a></li>
<li class="chapter" data-level="3.8.2" data-path="javascript-basics.html"><a href="javascript-basics.html#array-methods"><i class="fa fa-check"></i><b>3.8.2</b> Array methods</a></li>
</ul></li>
<li class="chapter" data-level="3.9" data-path="javascript-basics.html"><a href="javascript-basics.html#scope"><i class="fa fa-check"></i><b>3.9</b> Scope</a></li>
<li class="chapter" data-level="3.10" data-path="javascript-basics.html"><a href="javascript-basics.html#flow-control"><i class="fa fa-check"></i><b>3.10</b> Flow control</a>
<ul>
<li class="chapter" data-level="3.10.1" data-path="javascript-basics.html"><a href="javascript-basics.html#what-is-flow-control"><i class="fa fa-check"></i><b>3.10.1</b> What is flow control?</a></li>
<li class="chapter" data-level="3.10.2" data-path="javascript-basics.html"><a href="javascript-basics.html#conditionals"><i class="fa fa-check"></i><b>3.10.2</b> Conditionals</a></li>
<li class="chapter" data-level="3.10.3" data-path="javascript-basics.html"><a href="javascript-basics.html#loops"><i class="fa fa-check"></i><b>3.10.3</b> Loops</a></li>
</ul></li>
<li class="chapter" data-level="3.11" data-path="javascript-basics.html"><a href="javascript-basics.html#javascript-object-notation-json"><i class="fa fa-check"></i><b>3.11</b> JavaScript Object Notation (JSON)</a>
<ul>
<li class="chapter" data-level="3.11.1" data-path="javascript-basics.html"><a href="javascript-basics.html#javascript-json"><i class="fa fa-check"></i><b>3.11.1</b> JSON</a></li>
<li class="chapter" data-level="3.11.2" data-path="javascript-basics.html"><a href="javascript-basics.html#geojson"><i class="fa fa-check"></i><b>3.11.2</b> GeoJSON</a></li>
</ul></li>
<li class="chapter" data-level="3.12" data-path="javascript-basics.html"><a href="javascript-basics.html#exercise-2"><i class="fa fa-check"></i><b>3.12</b> Exercise</a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="javascript-interactivity.html"><a href="javascript-interactivity.html"><i class="fa fa-check"></i><b>4</b> JavaScript Interactivity</a>
<ul>
<li class="chapter" data-level="4.1" data-path="javascript-interactivity.html"><a href="javascript-interactivity.html#introduction-3"><i class="fa fa-check"></i><b>4.1</b> Introduction</a></li>
<li class="chapter" data-level="4.2" data-path="javascript-interactivity.html"><a href="javascript-interactivity.html#the-document-object-model"><i class="fa fa-check"></i><b>4.2</b> The Document Object Model (DOM)</a></li>
<li class="chapter" data-level="4.3" data-path="javascript-interactivity.html"><a href="javascript-interactivity.html#accessing-and-modifying-elements"><i class="fa fa-check"></i><b>4.3</b> Accessing and modifying elements</a>
<ul>
<li class="chapter" data-level="4.3.1" data-path="javascript-interactivity.html"><a href="javascript-interactivity.html#overview-accessing-and_modifying"><i class="fa fa-check"></i><b>4.3.1</b> Overview</a></li>
<li class="chapter" data-level="4.3.2" data-path="javascript-interactivity.html"><a href="javascript-interactivity.html#accessing-elements"><i class="fa fa-check"></i><b>4.3.2</b> Accessing elements</a></li>
<li class="chapter" data-level="4.3.3" data-path="javascript-interactivity.html"><a href="javascript-interactivity.html#getting-element-properties"><i class="fa fa-check"></i><b>4.3.3</b> Getting element properties</a></li>
<li class="chapter" data-level="4.3.4" data-path="javascript-interactivity.html"><a href="javascript-interactivity.html#modifying-elements"><i class="fa fa-check"></i><b>4.3.4</b> Modifying elements</a></li>
</ul></li>
<li class="chapter" data-level="4.4" data-path="javascript-interactivity.html"><a href="javascript-interactivity.html#event-listeners"><i class="fa fa-check"></i><b>4.4</b> Event listeners</a>
<ul>
<li class="chapter" data-level="4.4.1" data-path="javascript-interactivity.html"><a href="javascript-interactivity.html#event-types"><i class="fa fa-check"></i><b>4.4.1</b> Event types</a></li>
<li class="chapter" data-level="4.4.2" data-path="javascript-interactivity.html"><a href="javascript-interactivity.html#binding-event-listeners"><i class="fa fa-check"></i><b>4.4.2</b> Binding event listeners</a></li>
</ul></li>
<li class="chapter" data-level="4.5" data-path="javascript-interactivity.html"><a href="javascript-interactivity.html#hello-example"><i class="fa fa-check"></i><b>4.5</b> Hello example</a></li>
<li class="chapter" data-level="4.6" data-path="javascript-interactivity.html"><a href="javascript-interactivity.html#poles-example"><i class="fa fa-check"></i><b>4.6</b> Poles example</a></li>
<li class="chapter" data-level="4.7" data-path="javascript-interactivity.html"><a href="javascript-interactivity.html#operating-on-selection"><i class="fa fa-check"></i><b>4.7</b> Operating on multiple selections</a>
<ul>
<li class="chapter" data-level="4.7.1" data-path="javascript-interactivity.html"><a href="javascript-interactivity.html#example-page"><i class="fa fa-check"></i><b>4.7.1</b> Example page</a></li>
<li class="chapter" data-level="4.7.2" data-path="javascript-interactivity.html"><a href="javascript-interactivity.html#making-multiple-selections"><i class="fa fa-check"></i><b>4.7.2</b> Making multiple selections</a></li>
</ul></li>
<li class="chapter" data-level="4.8" data-path="javascript-interactivity.html"><a href="javascript-interactivity.html#getting-and-setting-input-values"><i class="fa fa-check"></i><b>4.8</b> Getting and setting input values</a></li>
<li class="chapter" data-level="4.9" data-path="javascript-interactivity.html"><a href="javascript-interactivity.html#multiple-event-listeners"><i class="fa fa-check"></i><b>4.9</b> Multiple event listeners</a></li>
<li class="chapter" data-level="4.10" data-path="javascript-interactivity.html"><a href="javascript-interactivity.html#the-event-object"><i class="fa fa-check"></i><b>4.10</b> The event object</a>
<ul>
<li class="chapter" data-level="4.10.1" data-path="javascript-interactivity.html"><a href="javascript-interactivity.html#event-object-properties"><i class="fa fa-check"></i><b>4.10.1</b> Event object properties</a></li>
<li class="chapter" data-level="4.10.2" data-path="javascript-interactivity.html"><a href="javascript-interactivity.html#event-target"><i class="fa fa-check"></i><b>4.10.2</b> The <code>.target</code> property</a></li>
</ul></li>
<li class="chapter" data-level="4.11" data-path="javascript-interactivity.html"><a href="javascript-interactivity.html#modifying-page-based-on-data"><i class="fa fa-check"></i><b>4.11</b> Modifying page based on data</a></li>
<li class="chapter" data-level="4.12" data-path="javascript-interactivity.html"><a href="javascript-interactivity.html#working-with-user-input"><i class="fa fa-check"></i><b>4.12</b> Calculator example</a></li>
<li class="chapter" data-level="4.13" data-path="javascript-interactivity.html"><a href="javascript-interactivity.html#exercise-3"><i class="fa fa-check"></i><b>4.13</b> Exercise</a></li>
</ul></li>
<li class="chapter" data-level="5" data-path="web-servers-1.html"><a href="web-servers-1.html"><i class="fa fa-check"></i><b>5</b> Web Servers</a>
<ul>
<li class="chapter" data-level="5.1" data-path="web-servers-1.html"><a href="web-servers-1.html#introduction-4"><i class="fa fa-check"></i><b>5.1</b> Introduction</a></li>
<li class="chapter" data-level="5.2" data-path="web-servers-1.html"><a href="web-servers-1.html#web-servers-2"><i class="fa fa-check"></i><b>5.2</b> Web servers</a></li>
<li class="chapter" data-level="5.3" data-path="web-servers-1.html"><a href="web-servers-1.html#communicating-through-http"><i class="fa fa-check"></i><b>5.3</b> Communicating through HTTP</a>
<ul>
<li class="chapter" data-level="5.3.1" data-path="web-servers-1.html"><a href="web-servers-1.html#web-protocols-and-http"><i class="fa fa-check"></i><b>5.3.1</b> Web protocols and HTTP</a></li>
<li class="chapter" data-level="5.3.2" data-path="web-servers-1.html"><a href="web-servers-1.html#http-methods"><i class="fa fa-check"></i><b>5.3.2</b> HTTP methods</a></li>
</ul></li>
<li class="chapter" data-level="5.4" data-path="web-servers-1.html"><a href="web-servers-1.html#static-vs-dynamic-servers"><i class="fa fa-check"></i><b>5.4</b> Static vs. dynamic servers</a>
<ul>
<li class="chapter" data-level="5.4.1" data-path="web-servers-1.html"><a href="web-servers-1.html#overview"><i class="fa fa-check"></i><b>5.4.1</b> Overview</a></li>
<li class="chapter" data-level="5.4.2" data-path="web-servers-1.html"><a href="web-servers-1.html#static-servers"><i class="fa fa-check"></i><b>5.4.2</b> Static servers</a></li>
<li class="chapter" data-level="5.4.3" data-path="web-servers-1.html"><a href="web-servers-1.html#dynamic-servers"><i class="fa fa-check"></i><b>5.4.3</b> Dynamic servers</a></li>
<li class="chapter" data-level="5.4.4" data-path="web-servers-1.html"><a href="web-servers-1.html#software-1"><i class="fa fa-check"></i><b>5.4.4</b> Software</a></li>
<li class="chapter" data-level="5.4.5" data-path="web-servers-1.html"><a href="web-servers-1.html#practical-considerations"><i class="fa fa-check"></i><b>5.4.5</b> Practical considerations</a></li>
</ul></li>
<li class="chapter" data-level="5.5" data-path="web-servers-1.html"><a href="web-servers-1.html#urls-and-file-structure"><i class="fa fa-check"></i><b>5.5</b> URLs and file structure</a>
<ul>
<li class="chapter" data-level="5.5.1" data-path="web-servers-1.html"><a href="web-servers-1.html#urls-and-index-html"><i class="fa fa-check"></i><b>5.5.1</b> URLs and <code>index.html</code></a></li>
<li class="chapter" data-level="5.5.2" data-path="web-servers-1.html"><a href="web-servers-1.html#file-structure"><i class="fa fa-check"></i><b>5.5.2</b> File structure</a></li>
<li class="chapter" data-level="5.5.3" data-path="web-servers-1.html"><a href="web-servers-1.html#relative-paths"><i class="fa fa-check"></i><b>5.5.3</b> Relative paths</a></li>
<li class="chapter" data-level="5.5.4" data-path="web-servers-1.html"><a href="web-servers-1.html#css-and-javasccript"><i class="fa fa-check"></i><b>5.5.4</b> CSS and JavaScript</a></li>
</ul></li>
<li class="chapter" data-level="5.6" data-path="web-servers-1.html"><a href="web-servers-1.html#running-a-static-server"><i class="fa fa-check"></i><b>5.6</b> Running a static server</a>
<ul>
<li class="chapter" data-level="5.6.1" data-path="web-servers-1.html"><a href="web-servers-1.html#overview-running-static-server"><i class="fa fa-check"></i><b>5.6.1</b> Overview</a></li>
<li class="chapter" data-level="5.6.2" data-path="web-servers-1.html"><a href="web-servers-1.html#local-with-python"><i class="fa fa-check"></i><b>5.6.2</b> Local with Python</a></li>
<li class="chapter" data-level="5.6.3" data-path="web-servers-1.html"><a href="web-servers-1.html#remote-with-github-pages"><i class="fa fa-check"></i><b>5.6.3</b> Remote with GitHub Pages</a></li>
</ul></li>
</ul></li>
<li class="part"><span><b>II Web Mapping with Leaflet</b></span></li>
<li class="chapter" data-level="6" data-path="leaflet.html"><a href="leaflet.html"><i class="fa fa-check"></i><b>6</b> Leaflet</a>
<ul>
<li class="chapter" data-level="6.1" data-path="leaflet.html"><a href="leaflet.html#introduction-5"><i class="fa fa-check"></i><b>6.1</b> Introduction</a></li>
<li class="chapter" data-level="6.2" data-path="leaflet.html"><a href="leaflet.html#what-is-web-map"><i class="fa fa-check"></i><b>6.2</b> What is a web map?</a></li>
<li class="chapter" data-level="6.3" data-path="leaflet.html"><a href="leaflet.html#what-is-leaflet"><i class="fa fa-check"></i><b>6.3</b> What is Leaflet?</a></li>
<li class="chapter" data-level="6.4" data-path="leaflet.html"><a href="leaflet.html#alternatives-to-leaflet"><i class="fa fa-check"></i><b>6.4</b> Alternatives to Leaflet</a></li>
<li class="chapter" data-level="6.5" data-path="leaflet.html"><a href="leaflet.html#creating-a-basic-web-map"><i class="fa fa-check"></i><b>6.5</b> Creating a basic web map</a>
<ul>
<li class="chapter" data-level="6.5.1" data-path="leaflet.html"><a href="leaflet.html#overview-creating-a-basic-web-map"><i class="fa fa-check"></i><b>6.5.1</b> Overview</a></li>
<li class="chapter" data-level="6.5.2" data-path="leaflet.html"><a href="leaflet.html#web-page-setup"><i class="fa fa-check"></i><b>6.5.2</b> Web page setup</a></li>
<li class="chapter" data-level="6.5.3" data-path="leaflet.html"><a href="leaflet.html#javascript-libraries"><i class="fa fa-check"></i><b>6.5.3</b> JavaScript libraries</a></li>
<li class="chapter" data-level="6.5.4" data-path="leaflet.html"><a href="leaflet.html#including-a-library"><i class="fa fa-check"></i><b>6.5.4</b> Including a library</a></li>
<li class="chapter" data-level="6.5.5" data-path="leaflet.html"><a href="leaflet.html#loading-a-local-script"><i class="fa fa-check"></i><b>6.5.5</b> Loading a local script</a></li>
<li class="chapter" data-level="6.5.6" data-path="leaflet.html"><a href="leaflet.html#loading-a-remote-script"><i class="fa fa-check"></i><b>6.5.6</b> Loading a remote script</a></li>
<li class="chapter" data-level="6.5.7" data-path="leaflet.html"><a href="leaflet.html#including-leaflet-css-js"><i class="fa fa-check"></i><b>6.5.7</b> Including Leaflet CSS and JavaScript</a></li>
<li class="chapter" data-level="6.5.8" data-path="leaflet.html"><a href="leaflet.html#adding-map-div"><i class="fa fa-check"></i><b>6.5.8</b> Adding map <code>&lt;div&gt;</code></a></li>
<li class="chapter" data-level="6.5.9" data-path="leaflet.html"><a href="leaflet.html#creating-map-object"><i class="fa fa-check"></i><b>6.5.9</b> Creating a map object</a></li>
<li class="chapter" data-level="6.5.10" data-path="leaflet.html"><a href="leaflet.html#what-are-tile-layers"><i class="fa fa-check"></i><b>6.5.10</b> What are tile layers?</a></li>
<li class="chapter" data-level="6.5.11" data-path="leaflet.html"><a href="leaflet.html#adding-a-tile-layer"><i class="fa fa-check"></i><b>6.5.11</b> Adding a tile layer</a></li>
<li class="chapter" data-level="6.5.12" data-path="leaflet.html"><a href="leaflet.html#tile-layer-providers"><i class="fa fa-check"></i><b>6.5.12</b> Tile layer providers</a></li>
</ul></li>
<li class="chapter" data-level="6.6" data-path="leaflet.html"><a href="leaflet.html#adding-vector-layers"><i class="fa fa-check"></i><b>6.6</b> Adding vector layers</a>
<ul>
<li class="chapter" data-level="6.6.1" data-path="leaflet.html"><a href="leaflet.html#overview-adding-vector-layers"><i class="fa fa-check"></i><b>6.6.1</b> Overview</a></li>
<li class="chapter" data-level="6.6.2" data-path="leaflet.html"><a href="leaflet.html#adding-markers"><i class="fa fa-check"></i><b>6.6.2</b> Adding markers</a></li>
<li class="chapter" data-level="6.6.3" data-path="leaflet.html"><a href="leaflet.html#adding-lines"><i class="fa fa-check"></i><b>6.6.3</b> Adding lines</a></li>
<li class="chapter" data-level="6.6.4" data-path="leaflet.html"><a href="leaflet.html#adding-polygons"><i class="fa fa-check"></i><b>6.6.4</b> Adding polygons</a></li>
<li class="chapter" data-level="6.6.5" data-path="leaflet.html"><a href="leaflet.html#other-layer-types"><i class="fa fa-check"></i><b>6.6.5</b> Other layer types</a></li>
</ul></li>
<li class="chapter" data-level="6.7" data-path="leaflet.html"><a href="leaflet.html#adding-popups"><i class="fa fa-check"></i><b>6.7</b> Adding popups</a></li>
<li class="chapter" data-level="6.8" data-path="leaflet.html"><a href="leaflet.html#adding-a-description"><i class="fa fa-check"></i><b>6.8</b> Adding a description</a></li>
<li class="chapter" data-level="6.9" data-path="leaflet.html"><a href="leaflet.html#introducing-map-events"><i class="fa fa-check"></i><b>6.9</b> Introducing map events</a></li>
<li class="chapter" data-level="6.10" data-path="leaflet.html"><a href="leaflet.html#exercise-06"><i class="fa fa-check"></i><b>6.10</b> Exercise</a></li>
</ul></li>
<li class="chapter" data-level="7" data-path="geojson-1.html"><a href="geojson-1.html"><i class="fa fa-check"></i><b>7</b> GeoJSON</a>
<ul>
<li class="chapter" data-level="7.1" data-path="geojson-1.html"><a href="geojson-1.html#introduction-6"><i class="fa fa-check"></i><b>7.1</b> Introduction</a></li>
<li class="chapter" data-level="7.2" data-path="geojson-1.html"><a href="geojson-1.html#what-is-geojson"><i class="fa fa-check"></i><b>7.2</b> What is GeoJSON?</a></li>
<li class="chapter" data-level="7.3" data-path="geojson-1.html"><a href="geojson-1.html#geojson-structure"><i class="fa fa-check"></i><b>7.3</b> GeoJSON structure</a>
<ul>
<li class="chapter" data-level="7.3.1" data-path="geojson-1.html"><a href="geojson-1.html#overview-geojson"><i class="fa fa-check"></i><b>7.3.1</b> Overview</a></li>
<li class="chapter" data-level="7.3.2" data-path="geojson-1.html"><a href="geojson-1.html#geometries"><i class="fa fa-check"></i><b>7.3.2</b> Geometries</a></li>
<li class="chapter" data-level="7.3.3" data-path="geojson-1.html"><a href="geojson-1.html#features"><i class="fa fa-check"></i><b>7.3.3</b> Features</a></li>
<li class="chapter" data-level="7.3.4" data-path="geojson-1.html"><a href="geojson-1.html#feature-collections"><i class="fa fa-check"></i><b>7.3.4</b> Feature collections</a></li>
</ul></li>
<li class="chapter" data-level="7.4" data-path="geojson-1.html"><a href="geojson-1.html#editing-geojson"><i class="fa fa-check"></i><b>7.4</b> Editing GeoJSON</a>
<ul>
<li class="chapter" data-level="7.4.1" data-path="geojson-1.html"><a href="geojson-1.html#geojson-io"><i class="fa fa-check"></i><b>7.4.1</b> geojson.io</a></li>
<li class="chapter" data-level="7.4.2" data-path="geojson-1.html"><a href="geojson-1.html#mapshaper"><i class="fa fa-check"></i><b>7.4.2</b> mapshaper</a></li>
</ul></li>
<li class="chapter" data-level="7.5" data-path="geojson-1.html"><a href="geojson-1.html#adding-geojson-to-leaflet-map"><i class="fa fa-check"></i><b>7.5</b> Adding GeoJSON to Leaflet map</a></li>
<li class="chapter" data-level="7.6" data-path="geojson-1.html"><a href="geojson-1.html#geojson-viewer"><i class="fa fa-check"></i><b>7.6</b> GeoJSON viewer example</a>
<ul>
<li class="chapter" data-level="7.6.1" data-path="geojson-1.html"><a href="geojson-1.html#viewer-structure"><i class="fa fa-check"></i><b>7.6.1</b> Viewer structure</a></li>
<li class="chapter" data-level="7.6.2" data-path="geojson-1.html"><a href="geojson-1.html#viewer-html-and-css"><i class="fa fa-check"></i><b>7.6.2</b> HTML and CSS</a></li>
<li class="chapter" data-level="7.6.3" data-path="geojson-1.html"><a href="geojson-1.html#base-map"><i class="fa fa-check"></i><b>7.6.3</b> Base map</a></li>
<li class="chapter" data-level="7.6.4" data-path="geojson-1.html"><a href="geojson-1.html#adding-an-event-listener"><i class="fa fa-check"></i><b>7.6.4</b> Adding an event listener</a></li>
<li class="chapter" data-level="7.6.5" data-path="geojson-1.html"><a href="geojson-1.html#using-layer-groups"><i class="fa fa-check"></i><b>7.6.5</b> Using layer groups</a></li>
</ul></li>
<li class="chapter" data-level="7.7" data-path="geojson-1.html"><a href="geojson-1.html#ajax"><i class="fa fa-check"></i><b>7.7</b> Ajax and the <code>fetch</code> API</a>
<ul>
<li class="chapter" data-level="7.7.1" data-path="geojson-1.html"><a href="geojson-1.html#overview-ajax"><i class="fa fa-check"></i><b>7.7.1</b> What is Ajax?</a></li>
<li class="chapter" data-level="7.7.2" data-path="geojson-1.html"><a href="geojson-1.html#ajax-examples"><i class="fa fa-check"></i><b>7.7.2</b> Ajax examples</a></li>
<li class="chapter" data-level="7.7.3" data-path="geojson-1.html"><a href="geojson-1.html#making-ajax-requests-with-fetch"><i class="fa fa-check"></i><b>7.7.3</b> The <code>fetch</code> API</a></li>
</ul></li>
<li class="chapter" data-level="7.8" data-path="geojson-1.html"><a href="geojson-1.html#loading-geojson-files"><i class="fa fa-check"></i><b>7.8</b> Loading GeoJSON files</a>
<ul>
<li class="chapter" data-level="7.8.1" data-path="geojson-1.html"><a href="geojson-1.html#loading-local-files"><i class="fa fa-check"></i><b>7.8.1</b> Loading local files</a></li>
<li class="chapter" data-level="7.8.2" data-path="geojson-1.html"><a href="geojson-1.html#loading-remote-files"><i class="fa fa-check"></i><b>7.8.2</b> Loading remote files</a></li>
</ul></li>
<li class="chapter" data-level="7.9" data-path="geojson-1.html"><a href="geojson-1.html#exercise-4"><i class="fa fa-check"></i><b>7.9</b> Exercise</a></li>
</ul></li>
<li class="chapter" data-level="8" data-path="symbology-and-interactivity.html"><a href="symbology-and-interactivity.html"><i class="fa fa-check"></i><b>8</b> Symbology and Interactivity</a>
<ul>
<li class="chapter" data-level="8.1" data-path="symbology-and-interactivity.html"><a href="symbology-and-interactivity.html#introduction-7"><i class="fa fa-check"></i><b>8.1</b> Introduction</a></li>
<li class="chapter" data-level="8.2" data-path="symbology-and-interactivity.html"><a href="symbology-and-interactivity.html#l-geojson-options"><i class="fa fa-check"></i><b>8.2</b> <code>L.geoJSON</code> options</a></li>
<li class="chapter" data-level="8.3" data-path="symbology-and-interactivity.html"><a href="symbology-and-interactivity.html#constant-style"><i class="fa fa-check"></i><b>8.3</b> Constant style</a></li>
<li class="chapter" data-level="8.4" data-path="symbology-and-interactivity.html"><a href="symbology-and-interactivity.html#varying-style"><i class="fa fa-check"></i><b>8.4</b> Varying style</a>
<ul>
<li class="chapter" data-level="8.4.1" data-path="symbology-and-interactivity.html"><a href="symbology-and-interactivity.html#setting-varying-style"><i class="fa fa-check"></i><b>8.4.1</b> Setting varying style</a></li>
<li class="chapter" data-level="8.4.2" data-path="symbology-and-interactivity.html"><a href="symbology-and-interactivity.html#states-example"><i class="fa fa-check"></i><b>8.4.2</b> States example</a></li>
<li class="chapter" data-level="8.4.3" data-path="symbology-and-interactivity.html"><a href="symbology-and-interactivity.html#towns-example"><i class="fa fa-check"></i><b>8.4.3</b> Towns example</a></li>
</ul></li>
<li class="chapter" data-level="8.5" data-path="symbology-and-interactivity.html"><a href="symbology-and-interactivity.html#constructing-popups-from-data"><i class="fa fa-check"></i><b>8.5</b> Constructing popups from data</a></li>
<li class="chapter" data-level="8.6" data-path="symbology-and-interactivity.html"><a href="symbology-and-interactivity.html#adding-a-legend"><i class="fa fa-check"></i><b>8.6</b> Adding a legend</a>
<ul>
<li class="chapter" data-level="8.6.1" data-path="symbology-and-interactivity.html"><a href="symbology-and-interactivity.html#setting-legend-contents-with-l.control"><i class="fa fa-check"></i><b>8.6.1</b> Setting legend contents with <code>L.control</code></a></li>
<li class="chapter" data-level="8.6.2" data-path="symbology-and-interactivity.html"><a href="symbology-and-interactivity.html#using-css-to-style-the-legend"><i class="fa fa-check"></i><b>8.6.2</b> Using CSS to style the legend</a></li>
</ul></li>
<li class="chapter" data-level="8.7" data-path="symbology-and-interactivity.html"><a href="symbology-and-interactivity.html#dynamic-style"><i class="fa fa-check"></i><b>8.7</b> Dynamic style</a>
<ul>
<li class="chapter" data-level="8.7.1" data-path="symbology-and-interactivity.html"><a href="symbology-and-interactivity.html#styling-in-response-to-events"><i class="fa fa-check"></i><b>8.7.1</b> Styling in response to events</a></li>
<li class="chapter" data-level="8.7.2" data-path="symbology-and-interactivity.html"><a href="symbology-and-interactivity.html#dynamic-control-contents"><i class="fa fa-check"></i><b>8.7.2</b> Dynamic control contents</a></li>
<li class="chapter" data-level="8.7.3" data-path="symbology-and-interactivity.html"><a href="symbology-and-interactivity.html#linked-views"><i class="fa fa-check"></i><b>8.7.3</b> Linked views</a></li>
</ul></li>
<li class="chapter" data-level="8.8" data-path="symbology-and-interactivity.html"><a href="symbology-and-interactivity.html#exercise-08"><i class="fa fa-check"></i><b>8.8</b> Exercise</a></li>
</ul></li>
<li class="part"><span><b>III Databases</b></span></li>
<li class="chapter" data-level="9" data-path="databases.html"><a href="databases.html"><i class="fa fa-check"></i><b>9</b> Databases</a>
<ul>
<li class="chapter" data-level="9.1" data-path="databases.html"><a href="databases.html#introduction-databases"><i class="fa fa-check"></i><b>9.1</b> Introduction</a></li>
<li class="chapter" data-level="9.2" data-path="databases.html"><a href="databases.html#what-is-carto"><i class="fa fa-check"></i><b>9.2</b> What is CARTO?</a>
<ul>
<li class="chapter" data-level="9.2.1" data-path="databases.html"><a href="databases.html#the-carto-platform"><i class="fa fa-check"></i><b>9.2.1</b> The CARTO platform</a></li>
<li class="chapter" data-level="9.2.2" data-path="databases.html"><a href="databases.html#alternatives-to-carto"><i class="fa fa-check"></i><b>9.2.2</b> Alternatives to CARTO</a></li>
</ul></li>
<li class="chapter" data-level="9.3" data-path="databases.html"><a href="databases.html#databases-1"><i class="fa fa-check"></i><b>9.3</b> Databases</a></li>
<li class="chapter" data-level="9.4" data-path="databases.html"><a href="databases.html#spatial-databases"><i class="fa fa-check"></i><b>9.4</b> Spatial databases</a></li>
<li class="chapter" data-level="9.5" data-path="databases.html"><a href="databases.html#what-is-postgis"><i class="fa fa-check"></i><b>9.5</b> What is PostGIS?</a></li>
<li class="chapter" data-level="9.6" data-path="databases.html"><a href="databases.html#what-is-sql"><i class="fa fa-check"></i><b>9.6</b> What is SQL?</a>
<ul>
<li class="chapter" data-level="9.6.1" data-path="databases.html"><a href="databases.html#overview-sql"><i class="fa fa-check"></i><b>9.6.1</b> Overview</a></li>
<li class="chapter" data-level="9.6.2" data-path="databases.html"><a href="databases.html#non-spatial-queries"><i class="fa fa-check"></i><b>9.6.2</b> Non-spatial queries</a></li>
<li class="chapter" data-level="9.6.3" data-path="databases.html"><a href="databases.html#the-geometry-column"><i class="fa fa-check"></i><b>9.6.3</b> The geometry column</a></li>
<li class="chapter" data-level="9.6.4" data-path="databases.html"><a href="databases.html#spatial-queries"><i class="fa fa-check"></i><b>9.6.4</b> Spatial queries</a></li>
</ul></li>
<li class="chapter" data-level="9.7" data-path="databases.html"><a href="databases.html#the-carto-sql-api"><i class="fa fa-check"></i><b>9.7</b> The CARTO SQL API</a>
<ul>
<li class="chapter" data-level="9.7.1" data-path="databases.html"><a href="databases.html#api-usage"><i class="fa fa-check"></i><b>9.7.1</b> API usage</a></li>
<li class="chapter" data-level="9.7.2" data-path="databases.html"><a href="databases.html#query-example"><i class="fa fa-check"></i><b>9.7.2</b> Query example</a></li>
<li class="chapter" data-level="9.7.3" data-path="databases.html"><a href="databases.html#uploading-your-data"><i class="fa fa-check"></i><b>9.7.3</b> Uploading your data</a></li>
</ul></li>
<li class="chapter" data-level="9.8" data-path="databases.html"><a href="databases.html#carto-and-leaflet"><i class="fa fa-check"></i><b>9.8</b> CARTO and Leaflet</a></li>
<li class="chapter" data-level="9.9" data-path="databases.html"><a href="databases.html#exercise-09"><i class="fa fa-check"></i><b>9.9</b> Exercise</a></li>
</ul></li>
<li class="chapter" data-level="10" data-path="non-spatial-queries-1.html"><a href="non-spatial-queries-1.html"><i class="fa fa-check"></i><b>10</b> Non-spatial Queries</a>
<ul>
<li class="chapter" data-level="10.1" data-path="non-spatial-queries-1.html"><a href="non-spatial-queries-1.html#introduction-8"><i class="fa fa-check"></i><b>10.1</b> Introduction</a></li>
<li class="chapter" data-level="10.2" data-path="non-spatial-queries-1.html"><a href="non-spatial-queries-1.html#subsetting-with-sql"><i class="fa fa-check"></i><b>10.2</b> Subsetting with SQL</a>
<ul>
<li class="chapter" data-level="10.2.1" data-path="non-spatial-queries-1.html"><a href="non-spatial-queries-1.html#filtering-based-on-attributes"><i class="fa fa-check"></i><b>10.2.1</b> Filtering based on attributes</a></li>
<li class="chapter" data-level="10.2.2" data-path="non-spatial-queries-1.html"><a href="non-spatial-queries-1.html#displaying-on-a-map"><i class="fa fa-check"></i><b>10.2.2</b> Displaying on a map</a></li>
</ul></li>
<li class="chapter" data-level="10.3" data-path="non-spatial-queries-1.html"><a href="non-spatial-queries-1.html#creating-a-dropdown-menu"><i class="fa fa-check"></i><b>10.3</b> Creating a dropdown menu</a></li>
<li class="chapter" data-level="10.4" data-path="non-spatial-queries-1.html"><a href="non-spatial-queries-1.html#populating-dropdown-options"><i class="fa fa-check"></i><b>10.4</b> Populating dropdown options</a>
<ul>
<li class="chapter" data-level="10.4.1" data-path="non-spatial-queries-1.html"><a href="non-spatial-queries-1.html#how-many-species-do-we-have"><i class="fa fa-check"></i><b>10.4.1</b> How many species do we have?</a></li>
<li class="chapter" data-level="10.4.2" data-path="non-spatial-queries-1.html"><a href="non-spatial-queries-1.html#dropdown-menu-placeholder"><i class="fa fa-check"></i><b>10.4.2</b> Dropdown menu placeholder</a></li>
<li class="chapter" data-level="10.4.3" data-path="non-spatial-queries-1.html"><a href="non-spatial-queries-1.html#finding-unique-values"><i class="fa fa-check"></i><b>10.4.3</b> Finding unique values</a></li>
<li class="chapter" data-level="10.4.4" data-path="non-spatial-queries-1.html"><a href="non-spatial-queries-1.html#adding-options"><i class="fa fa-check"></i><b>10.4.4</b> Adding the options</a></li>
</ul></li>
<li class="chapter" data-level="10.5" data-path="non-spatial-queries-1.html"><a href="non-spatial-queries-1.html#updating-the-map"><i class="fa fa-check"></i><b>10.5</b> Updating the map</a>
<ul>
<li class="chapter" data-level="10.5.1" data-path="non-spatial-queries-1.html"><a href="non-spatial-queries-1.html#overview-updating-map"><i class="fa fa-check"></i><b>10.5.1</b> Overview</a></li>
<li class="chapter" data-level="10.5.2" data-path="non-spatial-queries-1.html"><a href="non-spatial-queries-1.html#manual-example"><i class="fa fa-check"></i><b>10.5.2</b> Manual example</a></li>
<li class="chapter" data-level="10.5.3" data-path="non-spatial-queries-1.html"><a href="non-spatial-queries-1.html#automatic-updating"><i class="fa fa-check"></i><b>10.5.3</b> Automatic updating</a></li>
</ul></li>
<li class="chapter" data-level="10.6" data-path="non-spatial-queries-1.html"><a href="non-spatial-queries-1.html#rearranging-the-code"><i class="fa fa-check"></i><b>10.6</b> Refactoring the code</a></li>
<li class="chapter" data-level="10.7" data-path="non-spatial-queries-1.html"><a href="non-spatial-queries-1.html#exercise-10"><i class="fa fa-check"></i><b>10.7</b> Exercise</a></li>
</ul></li>
<li class="chapter" data-level="11" data-path="spatial-queries-1.html"><a href="spatial-queries-1.html"><i class="fa fa-check"></i><b>11</b> Spatial Queries</a>
<ul>
<li class="chapter" data-level="11.1" data-path="spatial-queries-1.html"><a href="spatial-queries-1.html#introduction-9"><i class="fa fa-check"></i><b>11.1</b> Introduction</a></li>
<li class="chapter" data-level="11.2" data-path="spatial-queries-1.html"><a href="spatial-queries-1.html#adding-marker-on-click"><i class="fa fa-check"></i><b>11.2</b> Adding markers on click</a>
<ul>
<li class="chapter" data-level="11.2.1" data-path="spatial-queries-1.html"><a href="spatial-queries-1.html#getting-click-coordinates"><i class="fa fa-check"></i><b>11.2.1</b> Getting click coordinates</a></li>
<li class="chapter" data-level="11.2.2" data-path="spatial-queries-1.html"><a href="spatial-queries-1.html#adding-custom-marker"><i class="fa fa-check"></i><b>11.2.2</b> Adding a custom marker</a></li>
</ul></li>
<li class="chapter" data-level="11.3" data-path="spatial-queries-1.html"><a href="spatial-queries-1.html#spatial-postgis-operators"><i class="fa fa-check"></i><b>11.3</b> Spatial PostGIS operators</a>
<ul>
<li class="chapter" data-level="11.3.1" data-path="spatial-queries-1.html"><a href="spatial-queries-1.html#overview-postgis-operators"><i class="fa fa-check"></i><b>11.3.1</b> Overview</a></li>
<li class="chapter" data-level="11.3.2" data-path="spatial-queries-1.html"><a href="spatial-queries-1.html#geographical-distance"><i class="fa fa-check"></i><b>11.3.2</b> Geographical distance</a></li>
<li class="chapter" data-level="11.3.3" data-path="spatial-queries-1.html"><a href="spatial-queries-1.html#sphere-vs-spheroid"><i class="fa fa-check"></i><b>11.3.3</b> Sphere vs. spheroid</a></li>
</ul></li>
<li class="chapter" data-level="11.4" data-path="spatial-queries-1.html"><a href="spatial-queries-1.html#adding-nearest-points-to-map"><i class="fa fa-check"></i><b>11.4</b> Adding nearest points to map</a></li>
<li class="chapter" data-level="11.5" data-path="spatial-queries-1.html"><a href="spatial-queries-1.html#drawing-line-connectors"><i class="fa fa-check"></i><b>11.5</b> Drawing line connectors</a></li>
<li class="chapter" data-level="11.6" data-path="spatial-queries-1.html"><a href="spatial-queries-1.html#exercise-5"><i class="fa fa-check"></i><b>11.6</b> Exercise</a></li>
</ul></li>
<li class="part"><span><b>IV Advanced Topics</b></span></li>
<li class="chapter" data-level="12" data-path="client-side-geoprocessing.html"><a href="client-side-geoprocessing.html"><i class="fa fa-check"></i><b>12</b> Client-side Geoprocessing</a>
<ul>
<li class="chapter" data-level="12.1" data-path="client-side-geoprocessing.html"><a href="client-side-geoprocessing.html#introduction-10"><i class="fa fa-check"></i><b>12.1</b> Introduction</a></li>
<li class="chapter" data-level="12.2" data-path="client-side-geoprocessing.html"><a href="client-side-geoprocessing.html#geoprocessing-with-turfjs"><i class="fa fa-check"></i><b>12.2</b> Geoprocessing with Turf.js</a>
<ul>
<li class="chapter" data-level="12.2.1" data-path="client-side-geoprocessing.html"><a href="client-side-geoprocessing.html#overview-turfjs"><i class="fa fa-check"></i><b>12.2.1</b> Overview</a></li>
<li class="chapter" data-level="12.2.2" data-path="client-side-geoprocessing.html"><a href="client-side-geoprocessing.html#including-the-turf-js-library"><i class="fa fa-check"></i><b>12.2.2</b> Including the Turf.js library</a></li>
</ul></li>
<li class="chapter" data-level="12.3" data-path="client-side-geoprocessing.html"><a href="client-side-geoprocessing.html#great-circle-line"><i class="fa fa-check"></i><b>12.3</b> Great Circle line</a></li>
<li class="chapter" data-level="12.4" data-path="client-side-geoprocessing.html"><a href="client-side-geoprocessing.html#continuously-updated-tin"><i class="fa fa-check"></i><b>12.4</b> Continuously updated TIN</a>
<ul>
<li class="chapter" data-level="12.4.1" data-path="client-side-geoprocessing.html"><a href="client-side-geoprocessing.html#overview-continuous-tin"><i class="fa fa-check"></i><b>12.4.1</b> Overview</a></li>
<li class="chapter" data-level="12.4.2" data-path="client-side-geoprocessing.html"><a href="client-side-geoprocessing.html#generating-random-points"><i class="fa fa-check"></i><b>12.4.2</b> Generating random points</a></li>
<li class="chapter" data-level="12.4.3" data-path="client-side-geoprocessing.html"><a href="client-side-geoprocessing.html#adding-a-tin-layer"><i class="fa fa-check"></i><b>12.4.3</b> Adding a TIN layer</a></li>
<li class="chapter" data-level="12.4.4" data-path="client-side-geoprocessing.html"><a href="client-side-geoprocessing.html#draggable-circle-markers"><i class="fa fa-check"></i><b>12.4.4</b> Draggable circle markers</a></li>
<li class="chapter" data-level="12.4.5" data-path="client-side-geoprocessing.html"><a href="client-side-geoprocessing.html#continuous-updating"><i class="fa fa-check"></i><b>12.4.5</b> Continuous updating</a></li>
</ul></li>
<li class="chapter" data-level="12.5" data-path="client-side-geoprocessing.html"><a href="client-side-geoprocessing.html#clustering"><i class="fa fa-check"></i><b>12.5</b> Clustering</a>
<ul>
<li class="chapter" data-level="12.5.1" data-path="client-side-geoprocessing.html"><a href="client-side-geoprocessing.html#overview-clustering"><i class="fa fa-check"></i><b>12.5.1</b> Overview</a></li>
<li class="chapter" data-level="12.5.2" data-path="client-side-geoprocessing.html"><a href="client-side-geoprocessing.html#processing-sets-of-features"><i class="fa fa-check"></i><b>12.5.2</b> Processing sets of features</a></li>
<li class="chapter" data-level="12.5.3" data-path="client-side-geoprocessing.html"><a href="client-side-geoprocessing.html#adding-a-convex-hull"><i class="fa fa-check"></i><b>12.5.3</b> Adding a Convex Hull</a></li>
<li class="chapter" data-level="12.5.4" data-path="client-side-geoprocessing.html"><a href="client-side-geoprocessing.html#dbscan-clustering"><i class="fa fa-check"></i><b>12.5.4</b> DBSCAN clustering</a></li>
</ul></li>
<li class="chapter" data-level="12.6" data-path="client-side-geoprocessing.html"><a href="client-side-geoprocessing.html#heatmaps-with-leafletheat"><i class="fa fa-check"></i><b>12.6</b> Heatmaps with Leaflet.heat</a></li>
<li class="chapter" data-level="12.7" data-path="client-side-geoprocessing.html"><a href="client-side-geoprocessing.html#exercise-6"><i class="fa fa-check"></i><b>12.7</b> Exercise</a></li>
</ul></li>
<li class="chapter" data-level="13" data-path="collaborative-mapping.html"><a href="collaborative-mapping.html"><i class="fa fa-check"></i><b>13</b> Collaborative Mapping</a>
<ul>
<li class="chapter" data-level="13.1" data-path="collaborative-mapping.html"><a href="collaborative-mapping.html#introduction-11"><i class="fa fa-check"></i><b>13.1</b> Introduction</a></li>
<li class="chapter" data-level="13.2" data-path="collaborative-mapping.html"><a href="collaborative-mapping.html#crowdsourcing"><i class="fa fa-check"></i><b>13.2</b> Crowdsourcing</a></li>
<li class="chapter" data-level="13.3" data-path="collaborative-mapping.html"><a href="collaborative-mapping.html#the-drawing-control"><i class="fa fa-check"></i><b>13.3</b> The drawing control</a></li>
<li class="chapter" data-level="13.4" data-path="collaborative-mapping.html"><a href="collaborative-mapping.html#working-with-drawn-items"><i class="fa fa-check"></i><b>13.4</b> Working with drawn items</a>
<ul>
<li class="chapter" data-level="13.4.1" data-path="collaborative-mapping.html"><a href="collaborative-mapping.html#printing-drawn-items-geojson"><i class="fa fa-check"></i><b>13.4.1</b> Printing drawn items GeoJSON</a></li>
<li class="chapter" data-level="13.4.2" data-path="collaborative-mapping.html"><a href="collaborative-mapping.html#expanded-geojson-viewer"><i class="fa fa-check"></i><b>13.4.2</b> Expanded GeoJSON viewer</a></li>
</ul></li>
<li class="chapter" data-level="13.5" data-path="collaborative-mapping.html"><a href="collaborative-mapping.html#submission-form"><i class="fa fa-check"></i><b>13.5</b> Submission form</a></li>
<li class="chapter" data-level="13.6" data-path="collaborative-mapping.html"><a href="collaborative-mapping.html#sending-features-to-the-database"><i class="fa fa-check"></i><b>13.6</b> Sending features to the database</a>
<ul>
<li class="chapter" data-level="13.6.1" data-path="collaborative-mapping.html"><a href="collaborative-mapping.html#setting-database-permissions"><i class="fa fa-check"></i><b>13.6.1</b> Setting database permissions</a></li>
<li class="chapter" data-level="13.6.2" data-path="collaborative-mapping.html"><a href="collaborative-mapping.html#adding-draw-control"><i class="fa fa-check"></i><b>13.6.2</b> Adding the drawing control</a></li>
</ul></li>
<li class="chapter" data-level="13.7" data-path="collaborative-mapping.html"><a href="collaborative-mapping.html#exercise-7"><i class="fa fa-check"></i><b>13.7</b> Exercise</a></li>
</ul></li>
<li class="part"><span><b>V Appendices</b></span></li>
<li class="appendix"><span><b>Appendix</b></span></li>
<li class="chapter" data-level="A" data-path="associated-files.html"><a href="associated-files.html"><i class="fa fa-check"></i><b>A</b> Associated Files</a></li>
<li class="chapter" data-level="B" data-path="list-of-examples.html"><a href="list-of-examples.html"><i class="fa fa-check"></i><b>B</b> List of Examples</a>
<ul>
<li class="chapter" data-level="B.1" data-path="list-of-examples.html"><a href="list-of-examples.html#main"><i class="fa fa-check"></i><b>B.1</b> Main</a></li>
<li class="chapter" data-level="B.2" data-path="list-of-examples.html"><a href="list-of-examples.html#additional"><i class="fa fa-check"></i><b>B.2</b> Additional</a>
<ul>
<li class="chapter" data-level="B.2.1" data-path="list-of-examples.html"><a href="list-of-examples.html#html-and-css"><i class="fa fa-check"></i><b>B.2.1</b> HTML and CSS</a></li>
<li class="chapter" data-level="B.2.2" data-path="list-of-examples.html"><a href="list-of-examples.html#javascript"><i class="fa fa-check"></i><b>B.2.2</b> JavaScript</a></li>
<li class="chapter" data-level="B.2.3" data-path="list-of-examples.html"><a href="list-of-examples.html#leaflet-1"><i class="fa fa-check"></i><b>B.2.3</b> Leaflet</a></li>
<li class="chapter" data-level="B.2.4" data-path="list-of-examples.html"><a href="list-of-examples.html#geo-processing"><i class="fa fa-check"></i><b>B.2.4</b> Geo-processing</a></li>
<li class="chapter" data-level="B.2.5" data-path="list-of-examples.html"><a href="list-of-examples.html#d-maps"><i class="fa fa-check"></i><b>B.2.5</b> 2.5D Maps</a></li>
<li class="chapter" data-level="B.2.6" data-path="list-of-examples.html"><a href="list-of-examples.html#d-maps-1"><i class="fa fa-check"></i><b>B.2.6</b> 3D maps</a></li>
<li class="chapter" data-level="B.2.7" data-path="list-of-examples.html"><a href="list-of-examples.html#animation"><i class="fa fa-check"></i><b>B.2.7</b> Animation</a></li>
<li class="chapter" data-level="B.2.8" data-path="list-of-examples.html"><a href="list-of-examples.html#real-time-data"><i class="fa fa-check"></i><b>B.2.8</b> Real-time data</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="C" data-path="list-of-exercise-solutions.html"><a href="list-of-exercise-solutions.html"><i class="fa fa-check"></i><b>C</b> List of Exercise Solutions</a></li>
<li class="chapter" data-level="D" data-path="bgu-course-2021.html"><a href="bgu-course-2021.html"><i class="fa fa-check"></i><b>D</b> BGU course 2021</a>
<ul>
<li class="chapter" data-level="D.1" data-path="bgu-course-2021.html"><a href="bgu-course-2021.html#place-and-time"><i class="fa fa-check"></i><b>D.1</b> Place and Time</a></li>
<li class="chapter" data-level="D.2" data-path="bgu-course-2021.html"><a href="bgu-course-2021.html#lecture-plan"><i class="fa fa-check"></i><b>D.2</b> Lecture plan</a></li>
<li class="chapter" data-level="D.3" data-path="bgu-course-2021.html"><a href="bgu-course-2021.html#project-submission-dates"><i class="fa fa-check"></i><b>D.3</b> Project submission dates</a></li>
<li class="chapter" data-level="D.4" data-path="bgu-course-2021.html"><a href="bgu-course-2021.html#additional-resources"><i class="fa fa-check"></i><b>D.4</b> Additional resources</a>
<ul>
<li class="chapter" data-level="D.4.1" data-path="bgu-course-2021.html"><a href="bgu-course-2021.html#html-css"><i class="fa fa-check"></i><b>D.4.1</b> HTML &amp; CSS</a></li>
<li class="chapter" data-level="D.4.2" data-path="bgu-course-2021.html"><a href="bgu-course-2021.html#javascript-1"><i class="fa fa-check"></i><b>D.4.2</b> JavaScript</a></li>
<li class="chapter" data-level="D.4.3" data-path="bgu-course-2021.html"><a href="bgu-course-2021.html#web-mapping"><i class="fa fa-check"></i><b>D.4.3</b> Web mapping</a></li>
<li class="chapter" data-level="D.4.4" data-path="bgu-course-2021.html"><a href="bgu-course-2021.html#postgis"><i class="fa fa-check"></i><b>D.4.4</b> PostGIS</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="E" data-path="projects.html"><a href="projects.html"><i class="fa fa-check"></i><b>E</b> Projects</a>
<ul>
<li class="chapter" data-level="E.1" data-path="projects.html"><a href="projects.html#overview-3"><i class="fa fa-check"></i><b>E.1</b> Overview</a></li>
<li class="chapter" data-level="E.2" data-path="projects.html"><a href="projects.html#carto-account"><i class="fa fa-check"></i><b>E.2</b> CARTO Account</a></li>
<li class="chapter" data-level="E.3" data-path="projects.html"><a href="projects.html#data"><i class="fa fa-check"></i><b>E.3</b> Data</a></li>
<li class="chapter" data-level="E.4" data-path="projects.html"><a href="projects.html#project-requirements"><i class="fa fa-check"></i><b>E.4</b> Project requirements</a>
<ul>
<li class="chapter" data-level="E.4.1" data-path="projects.html"><a href="projects.html#project-01"><i class="fa fa-check"></i><b>E.4.1</b> Project 01</a></li>
<li class="chapter" data-level="E.4.2" data-path="projects.html"><a href="projects.html#project-02"><i class="fa fa-check"></i><b>E.4.2</b> Project 02</a></li>
<li class="chapter" data-level="E.4.3" data-path="projects.html"><a href="projects.html#project-03"><i class="fa fa-check"></i><b>E.4.3</b> Project 03</a></li>
</ul></li>
<li class="chapter" data-level="E.5" data-path="projects.html"><a href="projects.html#submission"><i class="fa fa-check"></i><b>E.5</b> Submission</a></li>
<li class="chapter" data-level="E.6" data-path="projects.html"><a href="projects.html#grading"><i class="fa fa-check"></i><b>E.6</b> Grading</a></li>
</ul></li>
<li class="chapter" data-level="F" data-path="exam.html"><a href="exam.html"><i class="fa fa-check"></i><b>F</b> Exam</a>
<ul>
<li class="chapter" data-level="F.1" data-path="exam.html"><a href="exam.html#topics"><i class="fa fa-check"></i><b>F.1</b> Topics</a></li>
<li class="chapter" data-level="F.2" data-path="exam.html"><a href="exam.html#sample-questions"><i class="fa fa-check"></i><b>F.2</b> Sample questions</a>
<ul>
<li class="chapter" data-level="F.2.1" data-path="exam.html"><a href="exam.html#question-1"><i class="fa fa-check"></i><b>F.2.1</b> Question 1</a></li>
<li class="chapter" data-level="F.2.3" data-path="exam.html"><a href="exam.html#question-3"><i class="fa fa-check"></i><b>F.2.3</b> Question 3</a></li>
<li class="chapter" data-level="F.2.4" data-path="exam.html"><a href="exam.html#question-4"><i class="fa fa-check"></i><b>F.2.4</b> Question 4</a></li>
<li class="chapter" data-level="F.2.5" data-path="exam.html"><a href="exam.html#question-5"><i class="fa fa-check"></i><b>F.2.5</b> Question 5</a></li>
<li class="chapter" data-level="F.2.6" data-path="exam.html"><a href="exam.html#question-6"><i class="fa fa-check"></i><b>F.2.6</b> Question 6</a></li>
<li class="chapter" data-level="F.2.7" data-path="exam.html"><a href="exam.html#question-7"><i class="fa fa-check"></i><b>F.2.7</b> Question 7</a></li>
<li class="chapter" data-level="F.2.8" data-path="exam.html"><a href="exam.html#question-8"><i class="fa fa-check"></i><b>F.2.8</b> Question 8</a></li>
<li class="chapter" data-level="F.2.9" data-path="exam.html"><a href="exam.html#question-9"><i class="fa fa-check"></i><b>F.2.9</b> Question 9</a></li>
<li class="chapter" data-level="F.2.10" data-path="exam.html"><a href="exam.html#question-10"><i class="fa fa-check"></i><b>F.2.10</b> Question 10</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="G" data-path="additional-questions.html"><a href="additional-questions.html"><i class="fa fa-check"></i><b>G</b> Additional Questions</a>
<ul>
<li class="chapter" data-level="G.1" data-path="additional-questions.html"><a href="additional-questions.html#chapter-3"><i class="fa fa-check"></i><b>G.1</b> Chapter 3</a>
<ul>
<li class="chapter" data-level="G.1.1" data-path="additional-questions.html"><a href="additional-questions.html#modifying-global-variable"><i class="fa fa-check"></i><b>G.1.1</b> Modifying global variable</a></li>
<li class="chapter" data-level="G.1.2" data-path="additional-questions.html"><a href="additional-questions.html#insertingremoving-array-element"><i class="fa fa-check"></i><b>G.1.2</b> Inserting/removing array element</a></li>
<li class="chapter" data-level="G.1.3" data-path="additional-questions.html"><a href="additional-questions.html#object-oriented-language"><i class="fa fa-check"></i><b>G.1.3</b> Object Oriented language</a></li>
</ul></li>
<li class="chapter" data-level="G.2" data-path="additional-questions.html"><a href="additional-questions.html#chapter-4"><i class="fa fa-check"></i><b>G.2</b> Chapter 4</a>
<ul>
<li class="chapter" data-level="G.2.1" data-path="additional-questions.html"><a href="additional-questions.html#removing-collection-of-html-elements"><i class="fa fa-check"></i><b>G.2.1</b> Removing collection of HTML elements</a></li>
<li class="chapter" data-level="G.2.2" data-path="additional-questions.html"><a href="additional-questions.html#constraining-event-listener-frequency"><i class="fa fa-check"></i><b>G.2.2</b> Constraining event listener frequency</a></li>
<li class="chapter" data-level="G.2.3" data-path="additional-questions.html"><a href="additional-questions.html#saving-.getelementbyid-method-in-variable"><i class="fa fa-check"></i><b>G.2.3</b> Saving <code>.getElementById</code> method in variable</a></li>
</ul></li>
<li class="chapter" data-level="G.3" data-path="additional-questions.html"><a href="additional-questions.html#chapter-6"><i class="fa fa-check"></i><b>G.3</b> Chapter 6</a>
<ul>
<li class="chapter" data-level="G.3.1" data-path="additional-questions.html"><a href="additional-questions.html#routing"><i class="fa fa-check"></i><b>G.3.1</b> Routing</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="H" data-path="setting-up-an-sql-api.html"><a href="setting-up-an-sql-api.html"><i class="fa fa-check"></i><b>H</b> Setting up an SQL API</a>
<ul>
<li class="chapter" data-level="H.1" data-path="setting-up-an-sql-api.html"><a href="setting-up-an-sql-api.html#introduction-12"><i class="fa fa-check"></i><b>H.1</b> Introduction</a></li>
<li class="chapter" data-level="H.2" data-path="setting-up-an-sql-api.html"><a href="setting-up-an-sql-api.html#computer-with-fixed-ip-address"><i class="fa fa-check"></i><b>H.2</b> Computer with fixed IP address</a></li>
<li class="chapter" data-level="H.3" data-path="setting-up-an-sql-api.html"><a href="setting-up-an-sql-api.html#installing-postgresql-postgis"><i class="fa fa-check"></i><b>H.3</b> Installing PostgreSQL and PostGIS</a></li>
<li class="chapter" data-level="H.4" data-path="setting-up-an-sql-api.html"><a href="setting-up-an-sql-api.html#loading-data-into-the-database"><i class="fa fa-check"></i><b>H.4</b> Loading data into the database</a></li>
<li class="chapter" data-level="H.5" data-path="setting-up-an-sql-api.html"><a href="setting-up-an-sql-api.html#adding-read-only-database-user"><i class="fa fa-check"></i><b>H.5</b> Adding a read-only database user</a></li>
<li class="chapter" data-level="H.6" data-path="setting-up-an-sql-api.html"><a href="setting-up-an-sql-api.html#installing-nodejs-and-required-modules"><i class="fa fa-check"></i><b>H.6</b> Installing Node.js and required modules</a></li>
<li class="chapter" data-level="H.7" data-path="setting-up-an-sql-api.html"><a href="setting-up-an-sql-api.html#creating-a-service"><i class="fa fa-check"></i><b>H.7</b> Creating a service</a></li>
<li class="chapter" data-level="H.8" data-path="setting-up-an-sql-api.html"><a href="setting-up-an-sql-api.html#testing-the-sql-api"><i class="fa fa-check"></i><b>H.8</b> Testing the SQL API</a></li>
</ul></li>
<li class="chapter" data-level="I" data-path="setting-up-a-static-server-using-r.html"><a href="setting-up-a-static-server-using-r.html"><i class="fa fa-check"></i><b>I</b> Setting up a static server using R</a>
<ul>
<li class="chapter" data-level="I.1" data-path="setting-up-a-static-server-using-r.html"><a href="setting-up-a-static-server-using-r.html#introduction-13"><i class="fa fa-check"></i><b>I.1</b> Introduction</a></li>
<li class="chapter" data-level="I.2" data-path="setting-up-a-static-server-using-r.html"><a href="setting-up-a-static-server-using-r.html#installing-r"><i class="fa fa-check"></i><b>I.2</b> Installing R</a></li>
<li class="chapter" data-level="I.3" data-path="setting-up-a-static-server-using-r.html"><a href="setting-up-a-static-server-using-r.html#installing-the-servr-package"><i class="fa fa-check"></i><b>I.3</b> Installing the <code>servr</code> package</a></li>
<li class="chapter" data-level="I.4" data-path="setting-up-a-static-server-using-r.html"><a href="setting-up-a-static-server-using-r.html#starting-the-server"><i class="fa fa-check"></i><b>I.4</b> Starting the server</a></li>
</ul></li>
<li class="divider"></li>
<li><a href="https://bookdown.org/" target="blank">Published with bookdown</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="index-2.html">Introduction to Web Mapping</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="collaborative-mapping" class="section level1" number="13">
<h1><span class="header-section-number">Chapter 13</span> Collaborative Mapping</h1>
<p><i>Last updated: 2021-08-24 14:54:59 </i></p>
<div id="introduction-11" class="section level2" number="13.1">
<h2><span class="header-section-number">13.1</span> Introduction</h2>
<p>In this chapter, we demonstrate the construction of a special type of web maps—web maps for crowdsourcing of spatial data. Crowdsourcing web maps are used to collect, permanently store, and display spatial information contributed by numerous users. The scale of crowdsourcing can widely vary—from a web map intended for a short-term survey taken by a class or group of co-workers, up to massive collaborative projects such as OpenStreetMap where &gt;1000 GB of information have been collected<a href="#fn111" class="footnote-ref" id="fnref111"><sup>111</sup></a>.</p>
<p>While implementing a crowdsourcing web map, we are going to learn several new concepts and techniques, including map controls for drawing (“digitizing”) vector layers (Section <a href="collaborative-mapping.html#the-drawing-control">13.3</a>), using a submission form (Section <a href="collaborative-mapping.html#submission-form">13.5</a>), and using <code>POST</code> requests for sending information to a database (Section <a href="collaborative-mapping.html#sending-features-to-the-database">13.6</a>).</p>
</div>
<div id="crowdsourcing" class="section level2" number="13.2">
<h2><span class="header-section-number">13.2</span> Crowdsourcing</h2>
<p>Crowdsourcing is the idea of using the power of the crowd to collect data, as an alternative to other methods, such as using data from the government or from commercial companies. The main advantages of crowdsourcing are free access to the data for all, and the ability to keep the data up-to-date. The disadvantages are unequal coverage and the risk of sabotage.</p>
<p>The most well-known example of crowdsourcing is <a href="https://www.wikipedia.org/"><strong>Wikipedia</strong></a>, an encyclopedia created and edited by volunteers throughout the world, operating since 2001. The <a href="https://en.wikipedia.org/wiki/OpenStreetMap"><strong>OpenStreetMap (OSM)</strong></a> project, inspired by Wikipedia, was launched in 2004 to implement the idea of crowdsourcing in the field of spatial data and mapping. The aim of OSM is to create and maintain a single up-to-date digital map database of the world, through the work of volunteers, as an alternative to proprietary, out-of-date and fragmented data, predominantly used in the past. The OSM project is a big success: in many places, such as the U.S. and Western Europe, the level of detail and quality in OpenStreetMap is as good as commercial and government data sources.</p>
<p>From the technical point of view, crowdsourcing requires at minimum an interface where the contributors can log in and give their input, and a database where the inputs of the various contributors are being permanently stored. A crowdsourcing application needs to be simple, accessible, and intuitive, in order to reach the broadest audience possible. A crowdsourcing application for collecting spatial data, for example, needs to be intuitive not just to GIS professionals, but also to the general public. Web applications are a good fit for crowdsourcing due to their accessibility. For example, OSM has numerous editing interfaces, known as <a href="http://wiki.openstreetmap.org/wiki/Editors"><strong>editors</strong></a>. Currently, the web-based <a href="http://ideditor.com/"><strong>iD editor</strong></a> (Figure <a href="collaborative-mapping.html#fig:osm-id-editor">13.1</a>) is considered the default OSM editor and is responsible the largest share of OSM <a href="https://wiki.openstreetmap.org/wiki/Editor_usage_stats">edits</a>.</p>
<div class="figure" style="text-align: center"><span id="fig:osm-id-editor"></span>
<img src="images/osm_id_editor.png" alt="The iD editor, a web application for editing OpenStreetMap data" width="100%" />
<p class="caption">
FIGURE 13.1: The iD editor, a web application for editing OpenStreetMap data
</p>
</div>
<p>In this chapter, we are going to build a simple crowdsourcing web application. Unlike the iD editor, our crowdsourcing app will be quite minimal (Figure <a href="collaborative-mapping.html#fig:example-13-05">13.10</a>). For example, it will <em>not</em> have an authentication system or a complex input interface. However, the app we build will demonstrate the important concepts, which are:</p>
<ul>
<li>Having user <strong>input</strong> elements for collecting spatial data (e.g., digitizing)</li>
<li>Communication with a <strong>database</strong> for persistently storing users’ input</li>
</ul>
<p>We are going to build the crowdsourcing application in four steps:</p>
<ul>
<li>In <code>example-13-01.html</code>, we will learn how to add a <strong>drawing control</strong> for drawing shapes on a Leaflet map (Section <a href="collaborative-mapping.html#the-drawing-control">13.3</a>).</li>
<li>In <code>example-13-02.html</code> and <code>example-13-03.html</code>, we will learn about translating drawn shapes to <strong>GeoJSON</strong> (Section <a href="collaborative-mapping.html#working-with-drawn-items">13.4</a>).</li>
<li>In <code>example-13-04.html</code>, we will add a <strong>form</strong> where the user can enter attribute values along with the drawn shapes (Section <a href="collaborative-mapping.html#submission-form">13.5</a>).</li>
<li>In <code>example-13-05.html</code>, we will add a mechanism for sending the drawn shapes to a CARTO <strong>database</strong> for persistent storage (Section <a href="collaborative-mapping.html#sending-features-to-the-database">13.6</a>).</li>
</ul>
</div>
<div id="the-drawing-control" class="section level2" number="13.3">
<h2><span class="header-section-number">13.3</span> The drawing control</h2>
<p>The first thing we need for our crowdsourcing app is a vector editing toolbar. Using the toolbar, contributors will be able to draw shapes on the map, to be submitted and stored in a database later on (Section <a href="collaborative-mapping.html#sending-features-to-the-database">13.6</a>). To add an editing toolbar on top of a Leaflet map we will use the <a href="https://leaflet.github.io/Leaflet.draw/docs/leaflet-draw-latest.html"><strong>Leaflet.draw</strong></a> plugin. </p>
<p>We start with the basic map <code>example-06-02.html</code> from Section <a href="leaflet.html#adding-a-tile-layer">6.5.11</a>. First, we need to include the Leaflet.draw JavaScript and CSS files on our page. As usual, we will use local copies of the JavaScript and CSS files, placed in the <code>js</code> and <code>css</code> directories: </p>
<div class="sourceCode" id="cb445"><pre class="sourceCode html"><code class="sourceCode html"><span id="cb445-1"><a href="collaborative-mapping.html#cb445-1" aria-hidden="true" tabindex="-1"></a><span class="kw">&lt;link</span><span class="ot"> rel=</span><span class="st">&quot;stylesheet&quot;</span><span class="ot"> href=</span><span class="st">&quot;css/leaflet.draw.css&quot;</span><span class="kw">&gt;</span></span>
<span id="cb445-2"><a href="collaborative-mapping.html#cb445-2" aria-hidden="true" tabindex="-1"></a><span class="kw">&lt;script</span><span class="ot"> src=</span><span class="st">&quot;js/leaflet.draw.js&quot;</span><span class="kw">&gt;&lt;/script&gt;</span></span></code></pre></div>
<p>To load the files from a CDN, the above local paths can be replaced with the following URLs: </p>
<pre class="text"><code>https://cdnjs.cloudflare.com/ajax/libs/leaflet.draw/1.0.4/leaflet.draw.css
https://cdnjs.cloudflare.com/ajax/libs/leaflet.draw/1.0.4/leaflet.draw.js</code></pre>
<p>Like we did when including the Leaflet library (Section <a href="leaflet.html#including-leaflet-css-js">6.5.7</a>), using the local file option also requires downloading several image files. These images are necessary to display the icons in the drawing control (Figure <a href="collaborative-mapping.html#fig:draw-control">13.2</a>). The files can be obtained from <a href="https://cdnjs.com/libraries/leaflet.draw"><code>cdnjs.com</code></a>, or from the online version of the book (Section <a href="index.html#online-version">0.7</a>). The image files need to be placed in the <code>images</code> directory inside the <code>css</code> directory. </p>
<p>Next thing we need to have is an <strong>editable layer</strong> on our map. The shapes in the editable layer are the ones that we can actually edit, or supplement with new ones we draw, using the drawing control: </p>
<div class="sourceCode" id="cb447"><pre class="sourceCode js"><code class="sourceCode javascript"><span id="cb447-1"><a href="collaborative-mapping.html#cb447-1" aria-hidden="true" tabindex="-1"></a><span class="kw">let</span> drawnItems <span class="op">=</span> L<span class="op">.</span><span class="fu">featureGroup</span>()<span class="op">.</span><span class="fu">addTo</span>(map)<span class="op">;</span></span></code></pre></div>
<p>The editable layer, hereby named <code>drawnItems</code>, is a <strong>Feature Group</strong> object (Section <a href="leaflet.html#other-layer-types">6.6.5</a>). A Feature Group, in Leaflet, is similar to a Layer Group but with a few <a href="https://leafletjs.com/reference-1.7.1.html#featuregroup">additional capabilities</a>, which are beyond the scope of this book. For our purposes, both Layer Group and a Feature Group are used to combine several layers into one object, which facilitates actions such as clearing the map of all layers of a given type (Sections <a href="geojson-1.html#using-layer-groups">7.6.5</a> and <a href="non-spatial-queries-1.html#automatic-updating">10.5.3</a>). In the present example, we are using a Feature Group only because it is required by the Leaflet.draw plugin. As shown in the above expression, a feature group is created and added to the map exactly the same way as a layer group, except that we are using the <code>L.featureGroup</code> function instead of the <code>L.layerGroup</code> function. </p>
<p>Initializing the drawing control itself is done as follows: </p>
<div class="sourceCode" id="cb448"><pre class="sourceCode js"><code class="sourceCode javascript"><span id="cb448-1"><a href="collaborative-mapping.html#cb448-1" aria-hidden="true" tabindex="-1"></a><span class="kw">new</span> L<span class="op">.</span><span class="at">Control</span><span class="op">.</span><span class="fu">Draw</span>({</span>
<span id="cb448-2"><a href="collaborative-mapping.html#cb448-2" aria-hidden="true" tabindex="-1"></a>    <span class="dt">edit</span><span class="op">:</span> {</span>
<span id="cb448-3"><a href="collaborative-mapping.html#cb448-3" aria-hidden="true" tabindex="-1"></a>        <span class="dt">featureGroup</span><span class="op">:</span> drawnItems</span>
<span id="cb448-4"><a href="collaborative-mapping.html#cb448-4" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb448-5"><a href="collaborative-mapping.html#cb448-5" aria-hidden="true" tabindex="-1"></a>})<span class="op">.</span><span class="fu">addTo</span>(map)<span class="op">;</span></span></code></pre></div>
<p>The <code>new</code> keyword is a way to create a new object in JavaScript, which we have not seen until now. This method is a little different from creating objects through calling a <strong>constructor</strong> function, which is what we did so far (e.g., using <code>L.map</code>, <code>L.marker</code>, etc., without the <code>new</code> keyword). The practical differences between the two initialization methods are beyond the scope of this book. Again, we are using the <code>new</code> initialization method only because the <code>Leaflet.draw</code> plugin requires it. </p>
<p>The above expression initializes the drawing control and places it in the top-left corner of the web map (Figure <a href="collaborative-mapping.html#fig:draw-control">13.2</a>), similarly to the way that we initialized and added other types of controls throughout the book—a map description (Section <a href="leaflet.html#adding-a-description">6.8</a>), a legend (Section <a href="symbology-and-interactivity.html#adding-a-legend">8.6</a>), an information box (Section <a href="symbology-and-interactivity.html#dynamic-control-contents">8.7.2</a>), and a dropdown menu (Section <a href="non-spatial-queries-1.html#creating-a-dropdown-menu">10.3</a>). Upon initialization, the <code>L.Control.Draw</code> function accepts an options object where we can alter various settings to specify the structure and behavior of the drawing control. In our case, we set just one option: the fact that <code>drawnItems</code> is the Feature Group that stores all editable shapes. </p>
<div class="figure" style="text-align: center"><span id="fig:draw-control"></span>
<img src="images/draw_control.png" alt="The Leaflet.draw control" width="100%" />
<p class="caption">
FIGURE 13.2: The Leaflet.draw control
</p>
</div>
<p>If we added just the above two code sections, we would see the drawing control and could use it to draw shapes. However, once any of the shapes is finished it immediately disappears from the map. What we would usually like to have, instead, is that the drawn shapes persist on the map. That way, we can examine our creation: whether the drawing looks right, or whether we need to edit it further on. The key for setting up this behavior is the fact that interacting with the drawing control fires <a href="https://leaflet.github.io/Leaflet.draw/docs/leaflet-draw-latest.html#l-draw-event">custom events</a>, which we can listen to and respond to (Section <a href="leaflet.html#introducing-map-events">6.9</a>). </p>
<p>For example, creating any new shape with the drawing control fires the <code>draw:created</code> event in the browser. Furthermore, the <em>event object</em> (Section <a href="javascript-interactivity.html#the-event-object">4.10</a>) for the <code>draw:created</code> event contains a property named <code>layer</code>, which contains the newly drawn shape. Whenever the event fires, we can “capture” the newly drawn <code>e.layer</code> and add it to the <code>drawnItems</code> group, so that it persists on the map. This automatically makes the layer <em>editable</em>, since we set <code>drawnItems</code> as an editable group when initializing the drawing control (see above). The event listener for adding drawn shapes to <code>drawnItems</code> can be defined as follows:</p>
<div class="sourceCode" id="cb449"><pre class="sourceCode js"><code class="sourceCode javascript"><span id="cb449-1"><a href="collaborative-mapping.html#cb449-1" aria-hidden="true" tabindex="-1"></a>map<span class="op">.</span><span class="fu">addEventListener</span>(<span class="st">&quot;draw:created&quot;</span><span class="op">,</span> <span class="kw">function</span>(e) {</span>
<span id="cb449-2"><a href="collaborative-mapping.html#cb449-2" aria-hidden="true" tabindex="-1"></a>    e<span class="op">.</span><span class="at">layer</span><span class="op">.</span><span class="fu">addTo</span>(drawnItems)<span class="op">;</span></span>
<span id="cb449-3"><a href="collaborative-mapping.html#cb449-3" aria-hidden="true" tabindex="-1"></a>})<span class="op">;</span></span></code></pre></div>
<p>Together, the last three code sections initialize a drawing control inside our basic map, and set an editable layer where the drawn items are “collected” and displayed on the map. The result (<code>example-13-01.html</code>) is shown in Figure <a href="collaborative-mapping.html#fig:example-13-01">13.3</a>.</p>
<div class="figure" style="text-align: center"><span id="fig:example-13-01"></span>
<iframe src="examples/example-13-01.html" width="100%" height="400px">
</iframe>
<p class="caption">
FIGURE 13.3: <code>example-13-01.html</code> <a href="examples/example-13-01.html" title="View the Example" target="_blank">(Click to view this example on its own)</a>
</p>
</div>
<blockquote>
<ul>
<li>Open <code>example-13-01.html</code> in the browser.</li>
<li>Try drawing each of the six shape types: a line, a polygon, a rectangle, a circle, a marker, and a circle marker.</li>
<li>Click on the <strong>edit layers</strong> button (Figure <a href="collaborative-mapping.html#fig:draw-control">13.2</a>) to edit the shapes that you have drawn.</li>
<li>Click on the <strong>delete</strong> button (Figure <a href="collaborative-mapping.html#fig:draw-control">13.2</a>) to delete shapes.</li>
<li>Inspect the <code>drawnItems</code> object, which contains the currently drawn shapes, in the JavaScript console.</li>
<li>Run the expression <code>drawnItems.toGeoJSON()</code> to inspect the drawn shapes as GeoJSON.</li>
</ul>
</blockquote>
</div>
<div id="working-with-drawn-items" class="section level2" number="13.4">
<h2><span class="header-section-number">13.4</span> Working with drawn items</h2>
<div id="printing-drawn-items-geojson" class="section level3" number="13.4.1">
<h3><span class="header-section-number">13.4.1</span> Printing drawn items GeoJSON</h3>
<p>In the previous example (<code>example-13-01.html</code>), each time a new shape was drawn it was simply added to our <code>drawnItems</code> Feature Group. As a result, the shape was displayed on the map, and we could subsequently edit or delete it, as well as draw any number of additional shapes. Our next step is to see how we can do something more with the drawn shapes. We will learn how to access the geometry of the drawn shapes, convert it to a GeoJSON string, and do something with it, such as to print it in the console.</p>
<p>In <code>example-13-01.html</code>, the currently drawn shapes were contained in the <code>drawnItems</code> Feature Group. To print the GeoJSON of the drawn shapes, the only place in the code we need to modify is the <code>draw:created</code> event listener. Instead of the original event listener definition (Section <a href="collaborative-mapping.html#the-drawing-control">13.3</a> above), we can use the following, expanded one:</p>
<div class="sourceCode" id="cb450"><pre class="sourceCode js"><code class="sourceCode javascript"><span id="cb450-1"><a href="collaborative-mapping.html#cb450-1" aria-hidden="true" tabindex="-1"></a>map<span class="op">.</span><span class="fu">addEventListener</span>(<span class="st">&quot;draw:created&quot;</span><span class="op">,</span> <span class="kw">function</span>(e) {</span>
<span id="cb450-2"><a href="collaborative-mapping.html#cb450-2" aria-hidden="true" tabindex="-1"></a>    e<span class="op">.</span><span class="at">layer</span><span class="op">.</span><span class="fu">addTo</span>(drawnItems)<span class="op">;</span></span>
<span id="cb450-3"><a href="collaborative-mapping.html#cb450-3" aria-hidden="true" tabindex="-1"></a>    drawnItems<span class="op">.</span><span class="fu">eachLayer</span>(<span class="kw">function</span>(layer) {</span>
<span id="cb450-4"><a href="collaborative-mapping.html#cb450-4" aria-hidden="true" tabindex="-1"></a>        <span class="kw">let</span> geojson <span class="op">=</span> <span class="bu">JSON</span><span class="op">.</span><span class="fu">stringify</span>(layer<span class="op">.</span><span class="fu">toGeoJSON</span>()<span class="op">.</span><span class="at">geometry</span>)<span class="op">;</span></span>
<span id="cb450-5"><a href="collaborative-mapping.html#cb450-5" aria-hidden="true" tabindex="-1"></a>        <span class="bu">console</span><span class="op">.</span><span class="fu">log</span>(geojson)<span class="op">;</span></span>
<span id="cb450-6"><a href="collaborative-mapping.html#cb450-6" aria-hidden="true" tabindex="-1"></a>    })<span class="op">;</span></span>
<span id="cb450-7"><a href="collaborative-mapping.html#cb450-7" aria-hidden="true" tabindex="-1"></a>})<span class="op">;</span></span></code></pre></div>
<p>The novel part in this version is the second internal expression, starting with <code>drawnItems.eachLayer</code>. The <code>.eachLayer</code> method of a Feature Group (which a Layer Group also has), is a convenient method for doing something with each layer in the group. The <code>.eachLayer</code> method takes a function with one parameter (<code>layer</code>). The function is then applied to each of the layers in the object. This type of iteration should already be familiar; for example, the <code>.forEach</code> array method (Section <a href="javascript-basics.html#the-foreach-array-method">3.10.3.3</a>) or the <code>turf.clusterEach</code> function from Turf.js (Section <a href="client-side-geoprocessing.html#processing-sets-of-features">12.5.2</a>) are conceptually similar iteration methods. Conveniently, each layer in <code>drawnItems</code> is by definition a separately drawn shape<a href="#fn112" class="footnote-ref" id="fnref112"><sup>112</sup></a>, since each layer was added when we finished drawing a shape, and the <code>"draw:created"</code> event was fired.</p>
<p>Inside the function, which is applied on each layer, there are two expressions: </p>
<div class="sourceCode" id="cb451"><pre class="sourceCode js"><code class="sourceCode javascript"><span id="cb451-1"><a href="collaborative-mapping.html#cb451-1" aria-hidden="true" tabindex="-1"></a><span class="kw">let</span> geojson <span class="op">=</span> <span class="bu">JSON</span><span class="op">.</span><span class="fu">stringify</span>(layer<span class="op">.</span><span class="fu">toGeoJSON</span>()<span class="op">.</span><span class="at">geometry</span>)<span class="op">;</span></span>
<span id="cb451-2"><a href="collaborative-mapping.html#cb451-2" aria-hidden="true" tabindex="-1"></a><span class="bu">console</span><span class="op">.</span><span class="fu">log</span>(geojson)<span class="op">;</span></span></code></pre></div>
<p>These two expression actually do a lot:</p>
<ul>
<li>Converting the current <code>layer</code> to GeoJSON with the <code>.toGeoJSON</code> method (Section <a href="client-side-geoprocessing.html#continuous-updating">12.4.5</a>)</li>
<li>Selecting just the <code>"geometry"</code> property of the GeoJSON, using <code>.geometry</code> (Section <a href="geojson-1.html#geometries">7.3.2</a>)</li>
<li>Applying the <code>JSON.stringify</code> function to convert the GeoJSON geometry object to a string (Section <a href="javascript-basics.html#javascript-object-notation-json">3.11</a>)</li>
<li>Printing the string with <code>console.log</code></li>
</ul>
<p>The resulting map (<code>example-13-02.html</code>) is shown in Figure <a href="collaborative-mapping.html#fig:example-13-02">13.4</a>. The screenshot shows the GeoJSON string printed in the console after one shape (a rectangle) has been drawn on the map.</p>
<div class="figure" style="text-align: center"><span id="fig:example-13-02"></span>
<iframe src="examples/example-13-02.html" width="100%" height="400px">
</iframe>
<p class="caption">
FIGURE 13.4: <code>example-13-02.html</code> <a href="examples/example-13-02.html" title="View the Example" target="_blank">(Click to view this example on its own)</a>
</p>
</div>
<blockquote>
<ul>
<li>Open <code>example-13-02.html</code> in the browser.</li>
<li>Draw several shapes and inspect the output printed in the console.</li>
</ul>
</blockquote>
</div>
<div id="expanded-geojson-viewer" class="section level3" number="13.4.2">
<h3><span class="header-section-number">13.4.2</span> Expanded GeoJSON viewer</h3>
<p>As another example of doing something with the drawn shapes, we can now expand the GeoJSON viewer <code>example-07-02.html</code> (Figure <a href="geojson-1.html#fig:example-07-02">7.5</a>) from Section <a href="geojson-1.html#geojson-viewer">7.6</a>. In that example, we had a text area where the user could type GeoJSON strings. When clicking “submit,” the typed GeoJSON string was turned into a Leaflet layer and displayed on the map. Now that we know how to work with the drawing control, we can implement the other direction too: letting the user draw new shapes on the map and making the GeoJSON strings of those drawn shapes appear in the text area (Figure <a href="collaborative-mapping.html#fig:example-13-03">13.5</a>).</p>
<p>To make things simple, we will decide the user can only draw one geometry at a time, and cannot edit or delete it after creation. To do that, we define the drawing control a little differently, with editing disabled:</p>
<div class="sourceCode" id="cb452"><pre class="sourceCode js"><code class="sourceCode javascript"><span id="cb452-1"><a href="collaborative-mapping.html#cb452-1" aria-hidden="true" tabindex="-1"></a><span class="kw">new</span> L<span class="op">.</span><span class="at">Control</span><span class="op">.</span><span class="fu">Draw</span>({</span>
<span id="cb452-2"><a href="collaborative-mapping.html#cb452-2" aria-hidden="true" tabindex="-1"></a>    <span class="dt">edit</span><span class="op">:</span> <span class="kw">false</span></span>
<span id="cb452-3"><a href="collaborative-mapping.html#cb452-3" aria-hidden="true" tabindex="-1"></a>})<span class="op">.</span><span class="fu">addTo</span>(map)<span class="op">;</span></span></code></pre></div>
<p>The event listener we need to display the GeoJSON of drawn shapes inside the text area is as follows:</p>
<div class="sourceCode" id="cb453"><pre class="sourceCode js"><code class="sourceCode javascript"><span id="cb453-1"><a href="collaborative-mapping.html#cb453-1" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> <span class="fu">showText</span>(e) {</span>
<span id="cb453-2"><a href="collaborative-mapping.html#cb453-2" aria-hidden="true" tabindex="-1"></a>    layers<span class="op">.</span><span class="fu">clearLayers</span>()<span class="op">;</span></span>
<span id="cb453-3"><a href="collaborative-mapping.html#cb453-3" aria-hidden="true" tabindex="-1"></a>    <span class="kw">let</span> layer <span class="op">=</span> e<span class="op">.</span><span class="at">layer</span><span class="op">;</span></span>
<span id="cb453-4"><a href="collaborative-mapping.html#cb453-4" aria-hidden="true" tabindex="-1"></a>    layer<span class="op">.</span><span class="fu">addTo</span>(layers)<span class="op">;</span></span>
<span id="cb453-5"><a href="collaborative-mapping.html#cb453-5" aria-hidden="true" tabindex="-1"></a>    <span class="kw">let</span> geojson <span class="op">=</span> <span class="bu">JSON</span><span class="op">.</span><span class="fu">stringify</span>(layer<span class="op">.</span><span class="fu">toGeoJSON</span>()<span class="op">.</span><span class="at">geometry</span><span class="op">,</span> <span class="kw">null</span><span class="op">,</span> <span class="dv">4</span>)<span class="op">;</span></span>
<span id="cb453-6"><a href="collaborative-mapping.html#cb453-6" aria-hidden="true" tabindex="-1"></a>    <span class="bu">document</span><span class="op">.</span><span class="fu">getElementById</span>(<span class="st">&quot;geojsontext&quot;</span>)<span class="op">.</span><span class="at">value</span> <span class="op">=</span> geojson<span class="op">;</span></span>
<span id="cb453-7"><a href="collaborative-mapping.html#cb453-7" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb453-8"><a href="collaborative-mapping.html#cb453-8" aria-hidden="true" tabindex="-1"></a>map<span class="op">.</span><span class="fu">addEventListener</span>(<span class="st">&quot;draw:created&quot;</span><span class="op">,</span> showText)<span class="op">;</span></span></code></pre></div>
<p>The above code section binds a <code>"draw:created"</code> event listener to the map, implying that the <code>showText</code> function will be executed each time a new shape is drawn. Let us review the code body of the <code>showText</code> function, expression by expression:</p>
<ul>
<li><code>layers.clearLayers()</code> clears the map of all previously drawn shapes.</li>
<li><code>let layer = e.layer</code> captures the last drawn layer, using the <code>.layer</code> property of the event object, and assigns it to a variable named <code>layer</code>.</li>
<li><code>layer.addTo(layers)</code> adds the last drawn layer to the <code>layers</code> layer group, which stores the layers to be displayed on the map.</li>
<li><code>JSON.stringify(layer.toGeoJSON().geometry, null, 4)</code> extracts the GeoJSON text string of the last drawn geometry. The additional <code>(..., null, 4)</code> parameters in <code>JSON.stringify</code> make the output string indented and split into several lines (Section <a href="javascript-basics.html#geojson">3.11.2</a>).</li>
<li><code>$("#geojsontext").val(geojson)</code> replaces the current contents of the text area with the GeoJSON string of the last drawn shape.</li>
</ul>
<p>The new version of the GeoJSON viewer (<code>example-13-03.html</code>) is shown in Figure <a href="collaborative-mapping.html#fig:example-13-03">13.5</a>. The screenshot shows a line, created using the drawing control, and the corresponding GeoJSON that automatically appears in the text area.</p>
<div class="figure" style="text-align: center"><span id="fig:example-13-03"></span>
<iframe src="examples/example-13-03.html" width="100%" height="400px">
</iframe>
<p class="caption">
FIGURE 13.5: <code>example-13-03.html</code> <a href="examples/example-13-03.html" title="View the Example" target="_blank">(Click to view this example on its own)</a>
</p>
</div>
<p>When experimenting with the translation of different types of shapes to GeoJSON in <code>example-13-03.html</code>, you may note two peculiar things: </p>
<ul>
<li><strong>Markers</strong>, <strong>circles</strong>, and <strong>circle markers</strong> are all converted to <code>"Point"</code> geometries, which means that the distinction between these three layer types is not recorded in the GeoJSON.</li>
<li>A <strong>circle</strong> is converted to a <code>"Point"</code> geometry without the circle radius being recorded in the GeoJSON.</li>
</ul>
<p>In other words, drawn markers, circles, and circle markers all become <code>"Point"</code> geometries when converted to GeoJSON, where their original shape type and radius are not being kept.</p>
<p>Another thing to note is that the Leaflet.draw plugin only supports single-part geometries. In other words, using Leaflet.draw you can only create <code>"Point"</code>, <code>"LineString"</code>, and <code>"Polygon"</code> geometries. The other four GeoJSON geometry types, including the multi-part geometries <code>"MultiPoint"</code>, <code>"MultiLineString"</code>, and <code>"MultiPolygon"</code>, as well as <code>"GeometryCollection"</code>, cannot be created<a href="#fn113" class="footnote-ref" id="fnref113"><sup>113</sup></a>.</p>
<p>For simplicity and consistency with the GeoJSON format, which we are going to use to record drawn shapes and send them to the database, it therefore makes sense to only allow drawing of three shape types:</p>
<ul>
<li>Markers, which will be converted to <code>"Point"</code> GeoJSON</li>
<li>Lines, which will be converted to <code>"LineString"</code> GeoJSON</li>
<li>Polygons, which will be converted to <code>"Polygon"</code> GeoJSON</li>
</ul>
<p>Therefore, in the next two examples (Sections <a href="collaborative-mapping.html#submission-form">13.5</a>–<a href="collaborative-mapping.html#sending-features-to-the-database">13.6</a>), we will restrict the drawing control to just these three shape types.</p>
</div>
</div>
<div id="submission-form" class="section level2" number="13.5">
<h2><span class="header-section-number">13.5</span> Submission form</h2>
<p>In addition to the geometry, a crowdsourcing web application usually collects non-spatial attribute data too. For example, when contributing to OpenStreetMap, you typically draw (“digitize”) a geometry (a point, line, or polygon), then type in its non-spatial attributes, or <a href="https://wiki.openstreetmap.org/wiki/Tags"><strong>tags</strong></a> in OSM terminology. For example, when adding a new building to the OSM data you may include the <code>building=yes</code> tag, specify building height with the <code>building:height</code> tag, and so on. </p>
<p>In our next example (<code>example-13-04.html</code>), we will include a simple <strong>form</strong> (Section <a href="html.html#input-elements">1.6.13</a>), where the user enters a description and the contributor’s name. The description and name entered by the user are going to be sent to the database as non-spatial attributes, together with the GeoJSON representing the drawn geometry. </p>
<p>Like in the previous examples, the first thing we need is a drawing control definition. This time we will disable the buttons for adding circles, circle markers and rectangles. We keep the buttons for adding markers, lines, and polygons, which can be translated to <code>"Point"</code>, <code>"LineString"</code>, and <code>"Polygon"</code> GeoJSON geometries, respectively, without loss of information (Section <a href="collaborative-mapping.html#expanded-geojson-viewer">13.4.2</a>): </p>
<div class="sourceCode" id="cb454"><pre class="sourceCode js"><code class="sourceCode javascript"><span id="cb454-1"><a href="collaborative-mapping.html#cb454-1" aria-hidden="true" tabindex="-1"></a><span class="kw">new</span> L<span class="op">.</span><span class="at">Control</span><span class="op">.</span><span class="fu">Draw</span>({</span>
<span id="cb454-2"><a href="collaborative-mapping.html#cb454-2" aria-hidden="true" tabindex="-1"></a>    <span class="dt">draw</span> <span class="op">:</span> {</span>
<span id="cb454-3"><a href="collaborative-mapping.html#cb454-3" aria-hidden="true" tabindex="-1"></a>        <span class="dt">polygon</span> <span class="op">:</span> <span class="kw">true</span><span class="op">,</span></span>
<span id="cb454-4"><a href="collaborative-mapping.html#cb454-4" aria-hidden="true" tabindex="-1"></a>        <span class="dt">polyline</span> <span class="op">:</span> <span class="kw">true</span><span class="op">,</span></span>
<span id="cb454-5"><a href="collaborative-mapping.html#cb454-5" aria-hidden="true" tabindex="-1"></a>        <span class="dt">rectangle</span> <span class="op">:</span> <span class="kw">false</span><span class="op">,</span>     <span class="co">// Rectangles disabled</span></span>
<span id="cb454-6"><a href="collaborative-mapping.html#cb454-6" aria-hidden="true" tabindex="-1"></a>        <span class="dt">circle</span> <span class="op">:</span> <span class="kw">false</span><span class="op">,</span>        <span class="co">// Circles disabled </span></span>
<span id="cb454-7"><a href="collaborative-mapping.html#cb454-7" aria-hidden="true" tabindex="-1"></a>        <span class="dt">circlemarker</span> <span class="op">:</span> <span class="kw">false</span><span class="op">,</span>  <span class="co">// Circle markers disabled</span></span>
<span id="cb454-8"><a href="collaborative-mapping.html#cb454-8" aria-hidden="true" tabindex="-1"></a>        <span class="dt">marker</span><span class="op">:</span> <span class="kw">true</span></span>
<span id="cb454-9"><a href="collaborative-mapping.html#cb454-9" aria-hidden="true" tabindex="-1"></a>    }<span class="op">,</span></span>
<span id="cb454-10"><a href="collaborative-mapping.html#cb454-10" aria-hidden="true" tabindex="-1"></a>    <span class="dt">edit</span> <span class="op">:</span> {</span>
<span id="cb454-11"><a href="collaborative-mapping.html#cb454-11" aria-hidden="true" tabindex="-1"></a>        <span class="dt">featureGroup</span><span class="op">:</span> drawnItems</span>
<span id="cb454-12"><a href="collaborative-mapping.html#cb454-12" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb454-13"><a href="collaborative-mapping.html#cb454-13" aria-hidden="true" tabindex="-1"></a>})<span class="op">.</span><span class="fu">addTo</span>(map)<span class="op">;</span></span></code></pre></div>
<p>Our submission form will reside in a popup, conveniently appearing on top of the drawn shape once it is finished. The form contents will be defined with the following HTML code:</p>
<div class="sourceCode" id="cb455"><pre class="sourceCode html"><code class="sourceCode html"><span id="cb455-1"><a href="collaborative-mapping.html#cb455-1" aria-hidden="true" tabindex="-1"></a><span class="kw">&lt;form&gt;</span></span>
<span id="cb455-2"><a href="collaborative-mapping.html#cb455-2" aria-hidden="true" tabindex="-1"></a>    Description:<span class="kw">&lt;br&gt;&lt;input</span><span class="ot"> type=</span><span class="st">&quot;text&quot;</span><span class="ot"> id=</span><span class="st">&quot;input_desc&quot;</span><span class="kw">&gt;&lt;br&gt;</span></span>
<span id="cb455-3"><a href="collaborative-mapping.html#cb455-3" aria-hidden="true" tabindex="-1"></a>    Name:<span class="kw">&lt;br&gt;&lt;input</span><span class="ot"> type=</span><span class="st">&quot;text&quot;</span><span class="ot"> id=</span><span class="st">&quot;input_name&quot;</span><span class="kw">&gt;&lt;br&gt;</span></span>
<span id="cb455-4"><a href="collaborative-mapping.html#cb455-4" aria-hidden="true" tabindex="-1"></a>    <span class="kw">&lt;input</span><span class="ot"> type=</span><span class="st">&quot;button&quot;</span><span class="ot"> value=</span><span class="st">&quot;Submit&quot;</span><span class="ot"> id=</span><span class="st">&quot;submit&quot;</span><span class="kw">&gt;</span></span>
<span id="cb455-5"><a href="collaborative-mapping.html#cb455-5" aria-hidden="true" tabindex="-1"></a><span class="kw">&lt;/form&gt;</span></span></code></pre></div>
<p>You can see what the form looks like in Figure <a href="collaborative-mapping.html#fig:popup-form">13.6</a>. </p>
<div class="figure" style="text-align: center"><span id="fig:popup-form"></span>
<img src="images/popup_form.png" alt="A form for collecting non-spatial attributes inside a Leaflet popup" width="35%" />
<p class="caption">
FIGURE 13.6: A form for collecting non-spatial attributes inside a Leaflet popup
</p>
</div>
<p>Based on the above HTML code for creating the form, we can write a function called <code>createFormPopup</code> that binds and opens a popup with an editable form on the <code>drawnItems</code> feature group:</p>
<div class="sourceCode" id="cb456"><pre class="sourceCode js"><code class="sourceCode javascript"><span id="cb456-1"><a href="collaborative-mapping.html#cb456-1" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> <span class="fu">createFormPopup</span>() {</span>
<span id="cb456-2"><a href="collaborative-mapping.html#cb456-2" aria-hidden="true" tabindex="-1"></a>    <span class="kw">let</span> popupContent <span class="op">=</span> </span>
<span id="cb456-3"><a href="collaborative-mapping.html#cb456-3" aria-hidden="true" tabindex="-1"></a>        <span class="st">&#39;&lt;form&gt;&#39;</span> <span class="op">+</span> </span>
<span id="cb456-4"><a href="collaborative-mapping.html#cb456-4" aria-hidden="true" tabindex="-1"></a>        <span class="st">&#39;Description:&lt;br&gt;&lt;input type=&quot;text&quot; id=&quot;input_desc&quot;&gt;&lt;br&gt;&#39;</span> <span class="op">+</span></span>
<span id="cb456-5"><a href="collaborative-mapping.html#cb456-5" aria-hidden="true" tabindex="-1"></a>        <span class="st">&#39;Name:&lt;br&gt;&lt;input type=&quot;text&quot; id=&quot;input_name&quot;&gt;&lt;br&gt;&#39;</span> <span class="op">+</span></span>
<span id="cb456-6"><a href="collaborative-mapping.html#cb456-6" aria-hidden="true" tabindex="-1"></a>        <span class="st">&#39;&lt;input type=&quot;button&quot; value=&quot;Submit&quot; id=&quot;submit&quot;&gt;&#39;</span> <span class="op">+</span> </span>
<span id="cb456-7"><a href="collaborative-mapping.html#cb456-7" aria-hidden="true" tabindex="-1"></a>        <span class="st">&#39;&lt;/form&gt;&#39;</span><span class="op">;</span></span>
<span id="cb456-8"><a href="collaborative-mapping.html#cb456-8" aria-hidden="true" tabindex="-1"></a>    drawnItems<span class="op">.</span><span class="fu">bindPopup</span>(popupContent)<span class="op">.</span><span class="fu">openPopup</span>()<span class="op">;</span></span>
<span id="cb456-9"><a href="collaborative-mapping.html#cb456-9" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<p>The <code>createFormPopup</code> function will be executed each time the user finishes to draw a shape, so that he/she can also enter the name and description and submit everything to the database. Accordingly, we have to modify the <code>"draw:created"</code> event listener, so that when done editing, the “submit” popup will open. Basically, we replace the <code>drawnItems.eachLayer</code> iteration inside the <code>"draw:created"</code> event listener defined in <code>example-13-02.html</code>, with a <code>createFormPopup</code> function call. That way, instead of printing the drawn shape GeoJSON in the console, an editable popup will open:</p>
<div class="sourceCode" id="cb457"><pre class="sourceCode js"><code class="sourceCode javascript"><span id="cb457-1"><a href="collaborative-mapping.html#cb457-1" aria-hidden="true" tabindex="-1"></a>map<span class="op">.</span><span class="fu">addEventListener</span>(<span class="st">&quot;draw:created&quot;</span><span class="op">,</span> <span class="kw">function</span>(e) {</span>
<span id="cb457-2"><a href="collaborative-mapping.html#cb457-2" aria-hidden="true" tabindex="-1"></a>    e<span class="op">.</span><span class="at">layer</span><span class="op">.</span><span class="fu">addTo</span>(drawnItems)<span class="op">;</span></span>
<span id="cb457-3"><a href="collaborative-mapping.html#cb457-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">createFormPopup</span>()<span class="op">;</span></span>
<span id="cb457-4"><a href="collaborative-mapping.html#cb457-4" aria-hidden="true" tabindex="-1"></a>})<span class="op">;</span></span></code></pre></div>
<p>The event listener for clicking the “submit” button triggers the <code>setData</code> function. This is the part where we determine what to do with the drawn layer. Here is the definition of the <code>setData</code> function:</p>
<div class="sourceCode" id="cb458"><pre class="sourceCode js"><code class="sourceCode javascript"><span id="cb458-1"><a href="collaborative-mapping.html#cb458-1" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> <span class="fu">setData</span>(e) {</span>
<span id="cb458-2"><a href="collaborative-mapping.html#cb458-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb458-3"><a href="collaborative-mapping.html#cb458-3" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span>(e<span class="op">.</span><span class="at">target</span> <span class="op">&amp;&amp;</span> e<span class="op">.</span><span class="at">target</span><span class="op">.</span><span class="at">id</span> <span class="op">==</span> <span class="st">&quot;submit&quot;</span>) {</span>
<span id="cb458-4"><a href="collaborative-mapping.html#cb458-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb458-5"><a href="collaborative-mapping.html#cb458-5" aria-hidden="true" tabindex="-1"></a>        <span class="co">// Get user name and description</span></span>
<span id="cb458-6"><a href="collaborative-mapping.html#cb458-6" aria-hidden="true" tabindex="-1"></a>        <span class="kw">let</span> enteredUsername <span class="op">=</span> <span class="bu">document</span><span class="op">.</span><span class="fu">getElementById</span>(<span class="st">&quot;input_name&quot;</span>)<span class="op">.</span><span class="at">value</span><span class="op">;</span></span>
<span id="cb458-7"><a href="collaborative-mapping.html#cb458-7" aria-hidden="true" tabindex="-1"></a>        <span class="kw">let</span> enteredDescription <span class="op">=</span> <span class="bu">document</span><span class="op">.</span><span class="fu">getElementById</span>(<span class="st">&quot;input_desc&quot;</span>)<span class="op">.</span><span class="at">value</span><span class="op">;</span></span>
<span id="cb458-8"><a href="collaborative-mapping.html#cb458-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb458-9"><a href="collaborative-mapping.html#cb458-9" aria-hidden="true" tabindex="-1"></a>        <span class="co">// Print user name and description</span></span>
<span id="cb458-10"><a href="collaborative-mapping.html#cb458-10" aria-hidden="true" tabindex="-1"></a>        <span class="bu">console</span><span class="op">.</span><span class="fu">log</span>(enteredUsername)<span class="op">;</span></span>
<span id="cb458-11"><a href="collaborative-mapping.html#cb458-11" aria-hidden="true" tabindex="-1"></a>        <span class="bu">console</span><span class="op">.</span><span class="fu">log</span>(enteredDescription)<span class="op">;</span></span>
<span id="cb458-12"><a href="collaborative-mapping.html#cb458-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb458-13"><a href="collaborative-mapping.html#cb458-13" aria-hidden="true" tabindex="-1"></a>        <span class="co">// Get and print GeoJSON for each drawn layer</span></span>
<span id="cb458-14"><a href="collaborative-mapping.html#cb458-14" aria-hidden="true" tabindex="-1"></a>        drawnItems<span class="op">.</span><span class="fu">eachLayer</span>(<span class="kw">function</span>(layer) {</span>
<span id="cb458-15"><a href="collaborative-mapping.html#cb458-15" aria-hidden="true" tabindex="-1"></a>            <span class="kw">let</span> drawing <span class="op">=</span> <span class="bu">JSON</span><span class="op">.</span><span class="fu">stringify</span>(layer<span class="op">.</span><span class="fu">toGeoJSON</span>()<span class="op">.</span><span class="at">geometry</span>)<span class="op">;</span></span>
<span id="cb458-16"><a href="collaborative-mapping.html#cb458-16" aria-hidden="true" tabindex="-1"></a>            <span class="bu">console</span><span class="op">.</span><span class="fu">log</span>(drawing)<span class="op">;</span></span>
<span id="cb458-17"><a href="collaborative-mapping.html#cb458-17" aria-hidden="true" tabindex="-1"></a>        })<span class="op">;</span></span>
<span id="cb458-18"><a href="collaborative-mapping.html#cb458-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb458-19"><a href="collaborative-mapping.html#cb458-19" aria-hidden="true" tabindex="-1"></a>        <span class="co">// Clear drawn items layer</span></span>
<span id="cb458-20"><a href="collaborative-mapping.html#cb458-20" aria-hidden="true" tabindex="-1"></a>        drawnItems<span class="op">.</span><span class="fu">closePopup</span>()<span class="op">;</span></span>
<span id="cb458-21"><a href="collaborative-mapping.html#cb458-21" aria-hidden="true" tabindex="-1"></a>        drawnItems<span class="op">.</span><span class="fu">clearLayers</span>()<span class="op">;</span></span>
<span id="cb458-22"><a href="collaborative-mapping.html#cb458-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb458-23"><a href="collaborative-mapping.html#cb458-23" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb458-24"><a href="collaborative-mapping.html#cb458-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb458-25"><a href="collaborative-mapping.html#cb458-25" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<p>The <code>setData</code> function collects all of the user entered information into three variables, and just prints them in the console (for now): </p>
<ul>
<li><code>enteredUsername</code>—The text input from the <code>#input_name</code> field of the popup</li>
<li><code>enteredDescription</code>—The text input from the <code>#input_desc</code> field of the popup</li>
<li><code>drawing</code>—The geometry of each drawn shape, as GeoJSON</li>
</ul>
<p>The first two inputs, <code>enteredUsername</code> and <code>enteredDescription</code>, are extracted from the text input area using the <code>.value</code> property (Section <a href="javascript-interactivity.html#getting-and-setting-input-values">4.8</a>). The <code>drawing</code> variable is created a little differently, inside an <code>.eachLayer</code> iteration (Section <a href="collaborative-mapping.html#printing-drawn-items-geojson">13.4.1</a>). Using an iteration is essential, since the <code>drawnItems</code> feature group may contain more than one layer in case the user has drawn more than one shape. In such case, each layer is converted into a separate GeoJSON and separately printed in the console.</p>
<p>Finally, the <code>setData</code> function is followed by the corresponding event listener:</p>
<div class="sourceCode" id="cb459"><pre class="sourceCode js"><code class="sourceCode javascript"><span id="cb459-1"><a href="collaborative-mapping.html#cb459-1" aria-hidden="true" tabindex="-1"></a><span class="bu">document</span><span class="op">.</span><span class="fu">addEventListener</span>(<span class="st">&quot;click&quot;</span><span class="op">,</span> setData)<span class="op">;</span></span></code></pre></div>
<p>Note that the event listener is binded to the <em>document</em> rather than to the “submit” button. The reason is that the popup is a <em>dynamic</em> element. For instance, the popup may be closed and re-opened when the layer is being edited. As a result, the event listener would have to be binded each time the popup re-appears. The solution here is different, relying on a mechanism known as <a href="https://developer.mozilla.org/en-US/docs/Learn/JavaScript/Building_blocks/Events#Event_delegation">event delegation</a>. In the event listener function <code>setData</code>, the for submission code is conditioned on the event target being the element that has <code>id="submit"</code>, i.e., the button:</p>
<div class="sourceCode" id="cb460"><pre class="sourceCode js"><code class="sourceCode javascript"><span id="cb460-1"><a href="collaborative-mapping.html#cb460-1" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span>(e<span class="op">.</span><span class="at">target</span> <span class="op">&amp;&amp;</span> e<span class="op">.</span><span class="at">target</span><span class="op">.</span><span class="at">id</span> <span class="op">==</span> <span class="st">&quot;submit&quot;</span>) {<span class="op">...</span>}</span></code></pre></div>
<p>The part <code>e.target &amp;&amp; e.target.id == "submit"</code> means “check if <code>e.target</code> exists, and if it does check if its <code>id</code> is equal to <code>"submit"</code>. Since the event listener is binded to the <code>document</code>, it persists even if the popup is closed (or even if it was not created yet). However, the event listener is not triggered by any click in the <code>document</code>, but only by clicks on the”submit" button.</p>
<p>In the resulting web map <code>example-13-04.html</code> (Figure <a href="collaborative-mapping.html#fig:example-13-04">13.7</a>), the user can draw one or more shapes with the drawing control. Each time a shape is drawn, a popup with the <em>name</em> and <em>description</em> text inputs is opened. Once the user decides to click “submit,” the name and description, as well as each GeoJSON for the drawn shapes, are printed in the console. Finally, the popup is closed, and the layer is removed from the map using the <code>.closePopup</code> and <code>.clearLayers</code> methods in the last two expressions.</p>
<p>One minor inconvenience is that the submission popup remains open while entering the “edit” or “delete” modes. This is counter-intuitive, as we should not submit the drawing while still editing it and making changes. The following code binds a few additional event listeners to close the popup when the user enters the “edit” or “delete” modes, and re-open it when done editing or deleting. This is accomplished using <code>"draw:editstart"</code>, <code>"draw:deletestart"</code> event listeners combined with the <code>.openPopup</code> method on the one hand, and the <code>"draw:editstop"</code> and <code>"draw:deletestop"</code> event listeners combined with the <code>.closePopup</code> methods on the other hand.</p>
<p>As you can see in the code section that follows, the <code>"draw:deletestop"</code> event listener is slightly more complex: its internal code contains a conditional (Section <a href="javascript-basics.html#conditionals">3.10.2</a>) for checking whether the user has deleted <em>all</em> of the drawn shapes. In the latter case, running <code>drawnItems.openPopup()</code> would cause an error, since there are no layers to open the popup on. Therefore, a conditional is first being evaluated to verify that at least one layer remains when the user is done deleting. If there is at least one layer—the editable popup will open. If there are no layers left—nothing will happen; the user will see an empty map where he/she can draw new shapes once more.</p>
<div class="sourceCode" id="cb461"><pre class="sourceCode js"><code class="sourceCode javascript"><span id="cb461-1"><a href="collaborative-mapping.html#cb461-1" aria-hidden="true" tabindex="-1"></a>map<span class="op">.</span><span class="fu">addEventListener</span>(<span class="st">&quot;draw:editstart&quot;</span><span class="op">,</span> <span class="kw">function</span>(e) {</span>
<span id="cb461-2"><a href="collaborative-mapping.html#cb461-2" aria-hidden="true" tabindex="-1"></a>    drawnItems<span class="op">.</span><span class="fu">closePopup</span>()<span class="op">;</span></span>
<span id="cb461-3"><a href="collaborative-mapping.html#cb461-3" aria-hidden="true" tabindex="-1"></a>})<span class="op">;</span></span>
<span id="cb461-4"><a href="collaborative-mapping.html#cb461-4" aria-hidden="true" tabindex="-1"></a>map<span class="op">.</span><span class="fu">addEventListener</span>(<span class="st">&quot;draw:deletestart&quot;</span><span class="op">,</span> <span class="kw">function</span>(e) {</span>
<span id="cb461-5"><a href="collaborative-mapping.html#cb461-5" aria-hidden="true" tabindex="-1"></a>    drawnItems<span class="op">.</span><span class="fu">closePopup</span>()<span class="op">;</span></span>
<span id="cb461-6"><a href="collaborative-mapping.html#cb461-6" aria-hidden="true" tabindex="-1"></a>})<span class="op">;</span></span>
<span id="cb461-7"><a href="collaborative-mapping.html#cb461-7" aria-hidden="true" tabindex="-1"></a>map<span class="op">.</span><span class="fu">addEventListener</span>(<span class="st">&quot;draw:editstop&quot;</span><span class="op">,</span> <span class="kw">function</span>(e) {</span>
<span id="cb461-8"><a href="collaborative-mapping.html#cb461-8" aria-hidden="true" tabindex="-1"></a>    drawnItems<span class="op">.</span><span class="fu">openPopup</span>()<span class="op">;</span></span>
<span id="cb461-9"><a href="collaborative-mapping.html#cb461-9" aria-hidden="true" tabindex="-1"></a>})<span class="op">;</span></span>
<span id="cb461-10"><a href="collaborative-mapping.html#cb461-10" aria-hidden="true" tabindex="-1"></a>map<span class="op">.</span><span class="fu">addEventListener</span>(<span class="st">&quot;draw:deletestop&quot;</span><span class="op">,</span> <span class="kw">function</span>(e) {</span>
<span id="cb461-11"><a href="collaborative-mapping.html#cb461-11" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span>(drawnItems<span class="op">.</span><span class="fu">getLayers</span>()<span class="op">.</span><span class="at">length</span> <span class="op">&gt;</span> <span class="dv">0</span>) {</span>
<span id="cb461-12"><a href="collaborative-mapping.html#cb461-12" aria-hidden="true" tabindex="-1"></a>        drawnItems<span class="op">.</span><span class="fu">openPopup</span>()<span class="op">;</span></span>
<span id="cb461-13"><a href="collaborative-mapping.html#cb461-13" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb461-14"><a href="collaborative-mapping.html#cb461-14" aria-hidden="true" tabindex="-1"></a>})<span class="op">;</span></span></code></pre></div>
<p>The result (<code>example-13-04.html</code>) is shown in Figure <a href="collaborative-mapping.html#fig:example-13-04">13.7</a>.</p>
<div class="figure" style="text-align: center"><span id="fig:example-13-04"></span>
<iframe src="examples/example-13-04.html" width="100%" height="400px">
</iframe>
<p class="caption">
FIGURE 13.7: <code>example-13-04.html</code> <a href="examples/example-13-04.html" title="View the Example" target="_blank">(Click to view this example on its own)</a>
</p>
</div>
<blockquote>
<ul>
<li>Open <code>example-13-04.html</code> in the browser.</li>
<li>Draw several shapes, then fill-in the name and description and press the “submit” button on the popup.</li>
<li>Inspect the output printed in the console.</li>
<li>Try editing or deleting some of the shapes, then pressing “submit” once more; the output printed in the console should always reflect the up-to-date drawn shapes as shown on the map.</li>
</ul>
</blockquote>
</div>
<div id="sending-features-to-the-database" class="section level2" number="13.6">
<h2><span class="header-section-number">13.6</span> Sending features to the database</h2>
<div id="setting-database-permissions" class="section level3" number="13.6.1">
<h3><span class="header-section-number">13.6.1</span> Setting database permissions</h3>
<p>In the last example (<code>example-13-04.html</code>), the drawn layers were not really sent anywhere, just printed in the console. Other than an input interface, to have a functional crowdsourcing application we also need a permanent storage location and a mechanism for writing user input into that location. Through the rest of this chapter, we will see how the drawn shapes can be sent to a CARTO database, making the user input persistently stored, thus finalizing our crowdsourcing app. </p>
<p>Before we begin writing any JavaScript code for sending the data, we need to have a permanent storage location to collect the data. When using a relational database as permanent storage, what we need is an (empty) table in our database, having the corresponding columns and data types according to the data we intend to collect. On CARTO, we can create a new table (Figure <a href="collaborative-mapping.html#fig:carto-new-table">13.8</a>) with the <strong>New Dataset</strong> button which we already used to upload an existing layer, such as <code>plants.geojson</code> (Section <a href="databases.html#uploading-your-data">9.7.3</a>). This time, instead of uploading a GeoJSON file we need to choose <strong>CREATE EMPTY DATASET</strong>. The new table is empty, and conveniently it comes with the default <code>the_geom</code> (geometry), <code>description</code> (string), and <code>name</code> (string) columns, which is exactly what we need. In case we needed a different set of columns, we could always add or remove columns, or change column data types, using the CARTO interface. We will call the new table <code>beer_sheva</code>. </p>
<div class="figure" style="text-align: center"><span id="fig:carto-new-table"></span>
<img src="images/carto_new_table.png" alt="Creating an empty table on CARTO" width="100%" />
<p class="caption">
FIGURE 13.8: Creating an empty table on CARTO
</p>
</div>
<p>In case we are working with an SQL database through the command line, rather than the CARTO web interface, we could also create the <code>beer_sheva</code> table using the equivalent SQL command: </p>
<div class="sourceCode" id="cb462"><pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb462-1"><a href="collaborative-mapping.html#cb462-1" aria-hidden="true" tabindex="-1"></a><span class="kw">CREATE</span> <span class="kw">TABLE</span> beer_sheva(</span>
<span id="cb462-2"><a href="collaborative-mapping.html#cb462-2" aria-hidden="true" tabindex="-1"></a>  the_geom geometry,</span>
<span id="cb462-3"><a href="collaborative-mapping.html#cb462-3" aria-hidden="true" tabindex="-1"></a>  description text,</span>
<span id="cb462-4"><a href="collaborative-mapping.html#cb462-4" aria-hidden="true" tabindex="-1"></a>  name text</span>
<span id="cb462-5"><a href="collaborative-mapping.html#cb462-5" aria-hidden="true" tabindex="-1"></a>);</span></code></pre></div>
<p>Now, let us suppose that the crowdsourcing web map is ready and the user has drawn a point, which we decoded into the following GeoJSON string with <code>JSON.stringify</code>, like we do in <code>example-13-04.html</code>: </p>
<div class="sourceCode" id="cb463"><pre class="sourceCode js"><code class="sourceCode javascript"><span id="cb463-1"><a href="collaborative-mapping.html#cb463-1" aria-hidden="true" tabindex="-1"></a>{<span class="st">&quot;type&quot;</span><span class="op">:</span><span class="st">&quot;Point&quot;</span><span class="op">,</span><span class="st">&quot;coordinates&quot;</span><span class="op">:</span>[<span class="fl">34.838848</span><span class="op">,</span><span class="fl">31.296301</span>]}</span></code></pre></div>
<p>Subsequently, let us also suppose that the user has filled the values <code>"Point 1"</code> and <code>"Michael"</code> into the description and name fields of the popup form (Figure <a href="collaborative-mapping.html#fig:popup-form">13.6</a>), respectively. How can we actually insert these data into the newly created CARTO table? We can use the SQL <code>INSERT INTO</code> and <code>VALUES</code> keywords for inserting new data, as shown in the following SQL query example: </p>
<div class="sourceCode" id="cb464"><pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb464-1"><a href="collaborative-mapping.html#cb464-1" aria-hidden="true" tabindex="-1"></a><span class="kw">INSERT</span> <span class="kw">INTO</span> beer_sheva (the_geom, description, name) <span class="kw">VALUES</span> (</span>
<span id="cb464-2"><a href="collaborative-mapping.html#cb464-2" aria-hidden="true" tabindex="-1"></a>  ST_SetSRID(</span>
<span id="cb464-3"><a href="collaborative-mapping.html#cb464-3" aria-hidden="true" tabindex="-1"></a>    ST_GeomFromGeoJSON(</span>
<span id="cb464-4"><a href="collaborative-mapping.html#cb464-4" aria-hidden="true" tabindex="-1"></a>      <span class="st">&#39;{&quot;type&quot;:&quot;Point&quot;,&quot;coordinates&quot;:[34.838848,31.296301]}&#39;</span></span>
<span id="cb464-5"><a href="collaborative-mapping.html#cb464-5" aria-hidden="true" tabindex="-1"></a>    ), </span>
<span id="cb464-6"><a href="collaborative-mapping.html#cb464-6" aria-hidden="true" tabindex="-1"></a>  <span class="dv">4326</span></span>
<span id="cb464-7"><a href="collaborative-mapping.html#cb464-7" aria-hidden="true" tabindex="-1"></a>  ),</span>
<span id="cb464-8"><a href="collaborative-mapping.html#cb464-8" aria-hidden="true" tabindex="-1"></a>  <span class="st">&#39;Point 1&#39;</span>, </span>
<span id="cb464-9"><a href="collaborative-mapping.html#cb464-9" aria-hidden="true" tabindex="-1"></a>  <span class="st">&#39;Michael&#39;</span></span>
<span id="cb464-10"><a href="collaborative-mapping.html#cb464-10" aria-hidden="true" tabindex="-1"></a>);</span></code></pre></div>
<p>The query looks quite long and complex, but note the high-level structure used to specify the column names and values to insert: </p>
<div class="sourceCode" id="cb465"><pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb465-1"><a href="collaborative-mapping.html#cb465-1" aria-hidden="true" tabindex="-1"></a><span class="kw">INSERT</span> <span class="kw">INTO</span> beer_sheva(<span class="op">..</span>., <span class="op">..</span>., <span class="op">..</span>.) <span class="kw">VALUES</span> (<span class="op">..</span>., <span class="op">..</span>., <span class="op">..</span>.);</span></code></pre></div>
<p>The first three <code>...</code> symbols are replaced with the column names where the values go into. The last three <code>...</code> symbols are replaced with the values themselves. Note that the order of column names needs to match the order of values, so that the right value will be inserted into the right column. In the present example, the ordering of the first triplet (the column names <code>the_geom</code>, <code>description</code>, and <code>name</code>) matches the order of the second triplet after the <code>VALUES</code> keyword (the geometry, <code>'Point 1'</code>, and <code>'Michael'</code>). </p>
<p>To create the geometry value which goes into the <code>the_geom</code> column, the query makes use of the <code>ST_GeomFromGeoJSON</code> function to convert from GeoJSON into WKB. This is exactly the opposite of decoding the geometry column into GeoJSON text with <code>ST_AsGeoJSON</code> (Section <a href="databases.html#the-geometry-column">9.6.3</a>). The <code>ST_SetSRID</code> function specifies that our GeoJSON coordinates are in lon/lat, i.e., in the WGS84 coordinate reference system which we work with throughout the book (Section <a href="spatial-queries-1.html#spatial-postgis-operators">11.3</a>), specified with the EPSG code <code>4326</code>. </p>
<p>The corresponding CARTO SQL API query is given below: </p>
<pre class="text"><code>https://michaeldorman.carto.com/api/v2/sql?q=
INSERT INTO beer_sheva (the_geom, description, name) 
VALUES (ST_SetSRID(ST_GeomFromGeoJSON(
&#39;{&quot;type&quot;:&quot;Point&quot;,&quot;coordinates&quot;:[34.838848,31.296301]}&#39;
),4326),&#39;Point 1&#39;,&#39;Michael&#39;)</code></pre>
<p>Alas, the above API call will not work on a newly created table. Instead, an error message such as the following one will be returned: </p>
<pre><code>{&quot;error&quot;:[&quot;permission denied for relation beer_sheva&quot;]}</code></pre>
<p>This error message, as the phrase <code>"permission denied"</code> suggests, concerns the issue of database <strong>permissions</strong>, which we have not really considered yet. Any database, in fact, is associated with one or more database <em>users</em>, with each user having his/her own <em>password</em> and associated with a set of <em>privileges</em>, i.e., rules for what the user can and cannot do in the database. For example, an <strong>administrator</strong> may have the maximal set of privileges, meaning that he/she can do anything in the database: reading and writing into tables, creating new tables, deleting existing tables, adding or removing other users, granting or revoking privileges to other users, and so on. On the other hand, a <strong>read-only user</strong> may have limited “read-only” privileges, so that they can only consume content from the database but cannot make any changes in the tables, or in their own or other users’ privileges. </p>
<p>The way we accessed our CARTO database with the CARTO SQL API, in fact, implied a database connection with the default user named <code>publicuser</code>, which is automatically created by CARTO when setting up our account. The <code>publicuser</code> user has <em>read</em> permissions on all tables in our database, which is why we could execute any of the SQL queries starting with <code>SELECT</code> throughout Chapters <a href="databases.html#databases">9</a>–<a href="client-side-geoprocessing.html#client-side-geoprocessing">12</a>. The <code>publicuser</code>, however, by default does not have write permissions. This is why the above <code>INSERT</code> query failed with a <code>"permission denied"</code> error. </p>
<p>In addition to <code>publicuser</code>, CARTO defines an <a href="https://carto.com/developers/sql-api/guides/authentication/"><strong>API Key</strong></a> user, who has all possible privileges on the tables in the database: read, write, update, create, delete, and so on. To use the CARTO SQL API with the “API Key” user, we need to supply an additional <code>api_key</code> parameter in our query, as in: </p>
<pre class="text"><code>https://michaeldorman.carto.com/api/v2/sql?q=
INSERT INTO beer_sheva (the_geom, description, name) 
VALUES (ST_SetSRID(ST_GeomFromGeoJSON(
&#39;{&quot;type&quot;:&quot;Point&quot;,&quot;coordinates&quot;:[34.838848,31.296301]}&#39;
),4326),&#39;Point 1&#39;,&#39;Michael&#39;)&amp;
api_key=fb85************************************</code></pre>
<p>The <code>api_key</code> is a long string, which acts like a password. You can get the API Key from your account settings panel in the CARTO web interface. </p>
<p>So, there are actually two possible solutions to the <code>"permission denied"</code> problem when trying to insert a new record into the <code>beer_sheva</code> table: </p>
<ul>
<li>We can connect to the database with the <strong>API Key</strong> user, who has maximal privileges and therefore can execute <code>INSERT</code> queries on the <code>beer_sheva</code> table.</li>
<li>We can <strong>grant</strong> the <code>publicuser</code> user a new privilege, for executing <code>INSERT</code> queries on table <code>beer_sheva</code>.</li>
</ul>
<p>The first option may seem the most convenient, since the only thing we need to do is locate our API Key string in the CARTO interface and attach it in the SQL API query URL, as shown above. However, there is a serious security issue we need to consider when using this approach. If we include the API Key in our JavaScript code, in principle anyone looking into the source code of our page will be able to copy the API Key, and use it to make any kind of SQL query on our account, having maximal privileges. For example, if anyone wanted to, he/she could even permanently delete any table in our account using <code>DROP TABLE</code> command. Exposing the API Key in <em>client-side</em> scripts is therefore a serious security risk. The API Key is really intended only for <em>server-side</em> scripts, whose source code cannot be accessed by the web page users. For instance, the server-side script may accept requests with a password the user entered; if the password is valid the server can make a query to the CARTO SQL API and send back the result, otherwise the query will be rejected. This approach requires setting up a dynamic server (Section <a href="web-servers-1.html#dynamic-servers">5.4.3</a>), which means that, to use it securely, the API Key solution is not so simple after all. In this book, we concentrate on client-side solutions, so we will not elaborate further on the API Key approach. </p>
<p>For a simple crowdsourcing app, intended for a trusted audience, the second option of granting <code>INSERT</code> privileges to <code>publicuser</code> is a simple and effective solution. In a way, this makes our database exposed: anyone who enters our web page will be able to insert new records into the <code>beer_sheva</code> table. On the other hand, the worst-case scenario is just that our table will be filled with many unnecessary records. The only privilege we will grant is <code>INSERT</code>, which means that <code>publicuser</code> cannot delete any previously entered records or modify the table in any other way. Moreover, when the URL for our page is shared with a trusted audience, such as among students taking a survey in a class, the chances of someone taking the trouble of finding our page and intentionally sabotaging our database by filling it with a large amount of fake records is very small. Thus, in small-scale use cases, the effort of making a dynamic server with an authentication system may be superfluous, since the simple solution presented below is sufficient. </p>
<p>To grant the permission for making <code>INSERT</code> queries on the <code>beer_sheva</code> table, the following SQL query needs to be executed. The <code>publicuser</code> obviously does not have the permission to grant himself/herself with additional privileges. Therefore the query needs to be executed inside the <strong>SQL editor</strong> on the CARTO web interface, which implies full privileges (Figure <a href="collaborative-mapping.html#fig:carto-grant-insert">13.9</a>), or using the SQL API with the the API Key. </p>
<div class="sourceCode" id="cb469"><pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb469-1"><a href="collaborative-mapping.html#cb469-1" aria-hidden="true" tabindex="-1"></a><span class="kw">GRANT</span> <span class="kw">INSERT</span> (the_geom, description, name) </span>
<span id="cb469-2"><a href="collaborative-mapping.html#cb469-2" aria-hidden="true" tabindex="-1"></a>  <span class="kw">ON</span> beer_sheva </span>
<span id="cb469-3"><a href="collaborative-mapping.html#cb469-3" aria-hidden="true" tabindex="-1"></a>  <span class="kw">TO</span> publicuser;</span></code></pre></div>
<div class="figure" style="text-align: center"><span id="fig:carto-grant-insert"></span>
<img src="images/carto_grant_insert.png" alt="Granting &lt;code&gt;INSERT&lt;/code&gt; permission through the CARTO web interface" width="100%" />
<p class="caption">
FIGURE 13.9: Granting <code>INSERT</code> permission through the CARTO web interface
</p>
</div>
<p>After the query for granting new permissions is executed, the above <code>INSERT</code> API call, for adding a new record into the <code>beer_sheva</code> table, should work even without the API Key. In case you still see a message such as: </p>
<pre><code>{&quot;error&quot;:[&quot;permission denied for sequence beer_sheva_copy_cartodb_id_seq&quot;]}</code></pre>
<p>you need to execute the following query too, either in the web interface or with the API Key<a href="#fn114" class="footnote-ref" id="fnref114"><sup>114</sup></a>: </p>
<div class="sourceCode" id="cb471"><pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb471-1"><a href="collaborative-mapping.html#cb471-1" aria-hidden="true" tabindex="-1"></a><span class="kw">GRANT</span> <span class="kw">USAGE</span> <span class="kw">ON</span> <span class="kw">SEQUENCE</span> beer_sheva_copy_cartodb_id_seq</span>
<span id="cb471-2"><a href="collaborative-mapping.html#cb471-2" aria-hidden="true" tabindex="-1"></a>  <span class="kw">TO</span> publicuser;</span></code></pre></div>
<p>To disable the new permission, for example when data collection is completed and we do not want to accept any more entries into the <code>beer_sheva</code> table, we can always <strong>revoke</strong> the privilege granted to <code>publicuser</code> as follows: </p>
<div class="sourceCode" id="cb472"><pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb472-1"><a href="collaborative-mapping.html#cb472-1" aria-hidden="true" tabindex="-1"></a><span class="kw">REVOKE</span> <span class="kw">INSERT</span> <span class="kw">ON</span> <span class="kw">TABLE</span> beer_sheva </span>
<span id="cb472-2"><a href="collaborative-mapping.html#cb472-2" aria-hidden="true" tabindex="-1"></a>  <span class="kw">FROM</span> publicuser; </span></code></pre></div>
<p>After the <code>beer_sheva</code> table is created and the <code>INSERT</code> permissions are taken care of, the database is ready and waiting to receive the crowdsourced data. Now, let us move on to defining the web-map script for processing and sending the user-edited data to the database. </p>
</div>
<div id="adding-draw-control" class="section level3" number="13.6.2">
<h3><span class="header-section-number">13.6.2</span> Adding the drawing control</h3>
<p>Like in the previous examples, first thing we need in our script is to have a drawing control definition. We use the same definition from <code>example-13-04.html</code> (Section <a href="collaborative-mapping.html#submission-form">13.5</a>), with circles, circle markers, and rectangles disabled<a href="#fn115" class="footnote-ref" id="fnref115"><sup>115</sup></a>: </p>
<div class="sourceCode" id="cb473"><pre class="sourceCode js"><code class="sourceCode javascript"><span id="cb473-1"><a href="collaborative-mapping.html#cb473-1" aria-hidden="true" tabindex="-1"></a><span class="kw">new</span> L<span class="op">.</span><span class="at">Control</span><span class="op">.</span><span class="fu">Draw</span>({<span class="op">...</span>})<span class="op">.</span><span class="fu">addTo</span>(map)<span class="op">;</span></span></code></pre></div>
<p>Next, in case we would like the map to display the previous shapes drawn by other users, we can set up a layer group named <code>cartoData</code> to contain them: </p>
<div class="sourceCode" id="cb474"><pre class="sourceCode js"><code class="sourceCode javascript"><span id="cb474-1"><a href="collaborative-mapping.html#cb474-1" aria-hidden="true" tabindex="-1"></a><span class="kw">let</span> cartoData <span class="op">=</span> L<span class="op">.</span><span class="fu">layerGroup</span>()<span class="op">.</span><span class="fu">addTo</span>(map)<span class="op">;</span></span></code></pre></div>
<p>Accordingly, we need to load the items already contained in the <code>beer_sheva</code> table from previous editing sessions, using the following code section: </p>
<div class="sourceCode" id="cb475"><pre class="sourceCode js"><code class="sourceCode javascript"><span id="cb475-1"><a href="collaborative-mapping.html#cb475-1" aria-hidden="true" tabindex="-1"></a><span class="kw">let</span> url <span class="op">=</span> <span class="st">&quot;https://michaeldorman.carto.com/api/v2/sql&quot;</span><span class="op">;</span></span>
<span id="cb475-2"><a href="collaborative-mapping.html#cb475-2" aria-hidden="true" tabindex="-1"></a><span class="kw">let</span> urlGeoJSON <span class="op">=</span> url <span class="op">+</span> <span class="st">&quot;?format=GeoJSON&amp;q=&quot;</span><span class="op">;</span></span>
<span id="cb475-3"><a href="collaborative-mapping.html#cb475-3" aria-hidden="true" tabindex="-1"></a><span class="kw">let</span> sqlQuery <span class="op">=</span> <span class="st">&quot;SELECT the_geom, description, name FROM beer_sheva&quot;</span><span class="op">;</span></span>
<span id="cb475-4"><a href="collaborative-mapping.html#cb475-4" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> <span class="fu">addPopup</span>(feature<span class="op">,</span> layer) {</span>
<span id="cb475-5"><a href="collaborative-mapping.html#cb475-5" aria-hidden="true" tabindex="-1"></a>    layer<span class="op">.</span><span class="fu">bindPopup</span>(</span>
<span id="cb475-6"><a href="collaborative-mapping.html#cb475-6" aria-hidden="true" tabindex="-1"></a>        feature<span class="op">.</span><span class="at">properties</span><span class="op">.</span><span class="at">description</span> <span class="op">+</span> </span>
<span id="cb475-7"><a href="collaborative-mapping.html#cb475-7" aria-hidden="true" tabindex="-1"></a>        <span class="st">&quot;&lt;br&gt;Submitted by &quot;</span> <span class="op">+</span> feature<span class="op">.</span><span class="at">properties</span><span class="op">.</span><span class="at">name</span></span>
<span id="cb475-8"><a href="collaborative-mapping.html#cb475-8" aria-hidden="true" tabindex="-1"></a>    )<span class="op">;</span></span>
<span id="cb475-9"><a href="collaborative-mapping.html#cb475-9" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb475-10"><a href="collaborative-mapping.html#cb475-10" aria-hidden="true" tabindex="-1"></a><span class="fu">fetch</span>(urlGeoJSON <span class="op">+</span> sqlQuery)</span>
<span id="cb475-11"><a href="collaborative-mapping.html#cb475-11" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">then</span>(<span class="kw">function</span>(response) {</span>
<span id="cb475-12"><a href="collaborative-mapping.html#cb475-12" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> response<span class="op">.</span><span class="fu">json</span>()<span class="op">;</span></span>
<span id="cb475-13"><a href="collaborative-mapping.html#cb475-13" aria-hidden="true" tabindex="-1"></a>    })</span>
<span id="cb475-14"><a href="collaborative-mapping.html#cb475-14" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">then</span>(<span class="kw">function</span>(data) {</span>
<span id="cb475-15"><a href="collaborative-mapping.html#cb475-15" aria-hidden="true" tabindex="-1"></a>        L<span class="op">.</span><span class="fu">geoJSON</span>(data<span class="op">,</span> {<span class="dt">onEachFeature</span><span class="op">:</span> addPopup})<span class="op">.</span><span class="fu">addTo</span>(cartoData)<span class="op">;</span></span>
<span id="cb475-16"><a href="collaborative-mapping.html#cb475-16" aria-hidden="true" tabindex="-1"></a>    })<span class="op">;</span></span></code></pre></div>
<p>Note that the popup for each of the loaded features displays the <code>name</code> and the <code>description</code> properties, which were entered in previous sessions when submitting drawn shapes and saved in the <code>beer_sheva</code> table.</p>
<p>Other than loading previously stored shapes using the above code, the major change compared to <code>example-13-04.html</code> is in the <code>setData</code> function, which is responsible for saving the drawn shapes whenever the “submit” button is clicked. The new version is quite longer, since instead of just printing the data in the console it now sends the data for permanent storage in the CARTO database: </p>
<div class="sourceCode" id="cb476"><pre class="sourceCode js"><code class="sourceCode javascript"><span id="cb476-1"><a href="collaborative-mapping.html#cb476-1" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> <span class="fu">setData</span>() {</span>
<span id="cb476-2"><a href="collaborative-mapping.html#cb476-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb476-3"><a href="collaborative-mapping.html#cb476-3" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Get user name and description</span></span>
<span id="cb476-4"><a href="collaborative-mapping.html#cb476-4" aria-hidden="true" tabindex="-1"></a>    <span class="kw">let</span> enteredUsername <span class="op">=</span> <span class="bu">document</span><span class="op">.</span><span class="fu">getElementById</span>(<span class="st">&quot;input_name&quot;</span>)<span class="op">.</span><span class="at">value</span><span class="op">;</span></span>
<span id="cb476-5"><a href="collaborative-mapping.html#cb476-5" aria-hidden="true" tabindex="-1"></a>    <span class="kw">let</span> enteredDescription <span class="op">=</span> <span class="bu">document</span><span class="op">.</span><span class="fu">getElementById</span>(<span class="st">&quot;input_desc&quot;</span>)<span class="op">.</span><span class="at">value</span><span class="op">;</span></span>
<span id="cb476-6"><a href="collaborative-mapping.html#cb476-6" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb476-7"><a href="collaborative-mapping.html#cb476-7" aria-hidden="true" tabindex="-1"></a>    <span class="co">// For each drawn layer</span></span>
<span id="cb476-8"><a href="collaborative-mapping.html#cb476-8" aria-hidden="true" tabindex="-1"></a>    drawnItems<span class="op">.</span><span class="fu">eachLayer</span>(<span class="kw">function</span>(layer) {</span>
<span id="cb476-9"><a href="collaborative-mapping.html#cb476-9" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb476-10"><a href="collaborative-mapping.html#cb476-10" aria-hidden="true" tabindex="-1"></a>        <span class="co">// Create SQL expression to insert layer</span></span>
<span id="cb476-11"><a href="collaborative-mapping.html#cb476-11" aria-hidden="true" tabindex="-1"></a>            <span class="kw">let</span> drawing <span class="op">=</span> <span class="bu">JSON</span><span class="op">.</span><span class="fu">stringify</span>(layer<span class="op">.</span><span class="fu">toGeoJSON</span>()<span class="op">.</span><span class="at">geometry</span>)<span class="op">;</span></span>
<span id="cb476-12"><a href="collaborative-mapping.html#cb476-12" aria-hidden="true" tabindex="-1"></a>            <span class="kw">let</span> sql <span class="op">=</span> </span>
<span id="cb476-13"><a href="collaborative-mapping.html#cb476-13" aria-hidden="true" tabindex="-1"></a>                <span class="st">&quot;INSERT INTO beer_sheva (the_geom, description, name) &quot;</span> <span class="op">+</span> </span>
<span id="cb476-14"><a href="collaborative-mapping.html#cb476-14" aria-hidden="true" tabindex="-1"></a>                <span class="st">&quot;VALUES (ST_SetSRID(ST_GeomFromGeoJSON(&#39;&quot;</span> <span class="op">+</span> </span>
<span id="cb476-15"><a href="collaborative-mapping.html#cb476-15" aria-hidden="true" tabindex="-1"></a>                drawing <span class="op">+</span> <span class="st">&quot;&#39;), 4326), &#39;&quot;</span> <span class="op">+</span> </span>
<span id="cb476-16"><a href="collaborative-mapping.html#cb476-16" aria-hidden="true" tabindex="-1"></a>                enteredDescription <span class="op">+</span> <span class="st">&quot;&#39;, &#39;&quot;</span> <span class="op">+</span> </span>
<span id="cb476-17"><a href="collaborative-mapping.html#cb476-17" aria-hidden="true" tabindex="-1"></a>                enteredUsername <span class="op">+</span> <span class="st">&quot;&#39;)&quot;</span><span class="op">;</span></span>
<span id="cb476-18"><a href="collaborative-mapping.html#cb476-18" aria-hidden="true" tabindex="-1"></a>            <span class="bu">console</span><span class="op">.</span><span class="fu">log</span>(sql)<span class="op">;</span></span>
<span id="cb476-19"><a href="collaborative-mapping.html#cb476-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb476-20"><a href="collaborative-mapping.html#cb476-20" aria-hidden="true" tabindex="-1"></a>            <span class="co">// Send the data</span></span>
<span id="cb476-21"><a href="collaborative-mapping.html#cb476-21" aria-hidden="true" tabindex="-1"></a>            <span class="fu">fetch</span>(url<span class="op">,</span> {</span>
<span id="cb476-22"><a href="collaborative-mapping.html#cb476-22" aria-hidden="true" tabindex="-1"></a>                <span class="dt">method</span><span class="op">:</span> <span class="st">&quot;POST&quot;</span><span class="op">,</span></span>
<span id="cb476-23"><a href="collaborative-mapping.html#cb476-23" aria-hidden="true" tabindex="-1"></a>                <span class="dt">headers</span><span class="op">:</span> {</span>
<span id="cb476-24"><a href="collaborative-mapping.html#cb476-24" aria-hidden="true" tabindex="-1"></a>                    <span class="st">&quot;Content-Type&quot;</span><span class="op">:</span> <span class="st">&quot;application/x-www-form-urlencoded&quot;</span></span>
<span id="cb476-25"><a href="collaborative-mapping.html#cb476-25" aria-hidden="true" tabindex="-1"></a>                }<span class="op">,</span></span>
<span id="cb476-26"><a href="collaborative-mapping.html#cb476-26" aria-hidden="true" tabindex="-1"></a>                <span class="dt">body</span><span class="op">:</span> <span class="st">&quot;q=&quot;</span> <span class="op">+</span> <span class="pp">encodeURI</span>(sql)</span>
<span id="cb476-27"><a href="collaborative-mapping.html#cb476-27" aria-hidden="true" tabindex="-1"></a>            })</span>
<span id="cb476-28"><a href="collaborative-mapping.html#cb476-28" aria-hidden="true" tabindex="-1"></a>            <span class="op">.</span><span class="fu">then</span>(<span class="kw">function</span>(response) {</span>
<span id="cb476-29"><a href="collaborative-mapping.html#cb476-29" aria-hidden="true" tabindex="-1"></a>                <span class="cf">return</span> response<span class="op">.</span><span class="fu">json</span>()<span class="op">;</span></span>
<span id="cb476-30"><a href="collaborative-mapping.html#cb476-30" aria-hidden="true" tabindex="-1"></a>            })</span>
<span id="cb476-31"><a href="collaborative-mapping.html#cb476-31" aria-hidden="true" tabindex="-1"></a>            <span class="op">.</span><span class="fu">then</span>(<span class="kw">function</span>(data) {</span>
<span id="cb476-32"><a href="collaborative-mapping.html#cb476-32" aria-hidden="true" tabindex="-1"></a>                <span class="bu">console</span><span class="op">.</span><span class="fu">log</span>(<span class="st">&quot;Data saved:&quot;</span><span class="op">,</span> data)<span class="op">;</span></span>
<span id="cb476-33"><a href="collaborative-mapping.html#cb476-33" aria-hidden="true" tabindex="-1"></a>            })</span>
<span id="cb476-34"><a href="collaborative-mapping.html#cb476-34" aria-hidden="true" tabindex="-1"></a>            <span class="op">.</span><span class="fu">catch</span>(<span class="kw">function</span>(error) {</span>
<span id="cb476-35"><a href="collaborative-mapping.html#cb476-35" aria-hidden="true" tabindex="-1"></a>                <span class="bu">console</span><span class="op">.</span><span class="fu">log</span>(<span class="st">&quot;Problem saving the data:&quot;</span><span class="op">,</span> error)<span class="op">;</span></span>
<span id="cb476-36"><a href="collaborative-mapping.html#cb476-36" aria-hidden="true" tabindex="-1"></a>            })<span class="op">;</span></span>
<span id="cb476-37"><a href="collaborative-mapping.html#cb476-37" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb476-38"><a href="collaborative-mapping.html#cb476-38" aria-hidden="true" tabindex="-1"></a>        <span class="co">// Transfer submitted drawing to the CARTO layer</span></span>
<span id="cb476-39"><a href="collaborative-mapping.html#cb476-39" aria-hidden="true" tabindex="-1"></a>        <span class="kw">let</span> newData <span class="op">=</span> layer<span class="op">.</span><span class="fu">toGeoJSON</span>()<span class="op">;</span></span>
<span id="cb476-40"><a href="collaborative-mapping.html#cb476-40" aria-hidden="true" tabindex="-1"></a>        newData<span class="op">.</span><span class="at">properties</span><span class="op">.</span><span class="at">description</span> <span class="op">=</span> enteredDescription<span class="op">;</span></span>
<span id="cb476-41"><a href="collaborative-mapping.html#cb476-41" aria-hidden="true" tabindex="-1"></a>        newData<span class="op">.</span><span class="at">properties</span><span class="op">.</span><span class="at">name</span> <span class="op">=</span> enteredUsername<span class="op">;</span></span>
<span id="cb476-42"><a href="collaborative-mapping.html#cb476-42" aria-hidden="true" tabindex="-1"></a>        L<span class="op">.</span><span class="fu">geoJSON</span>(newData<span class="op">,</span> {<span class="dt">onEachFeature</span><span class="op">:</span> addPopup})<span class="op">.</span><span class="fu">addTo</span>(cartoData)<span class="op">;</span></span>
<span id="cb476-43"><a href="collaborative-mapping.html#cb476-43" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb476-44"><a href="collaborative-mapping.html#cb476-44" aria-hidden="true" tabindex="-1"></a>    })<span class="op">;</span></span>
<span id="cb476-45"><a href="collaborative-mapping.html#cb476-45" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb476-46"><a href="collaborative-mapping.html#cb476-46" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Clear drawn items layer</span></span>
<span id="cb476-47"><a href="collaborative-mapping.html#cb476-47" aria-hidden="true" tabindex="-1"></a>    drawnItems<span class="op">.</span><span class="fu">closePopup</span>()<span class="op">;</span></span>
<span id="cb476-48"><a href="collaborative-mapping.html#cb476-48" aria-hidden="true" tabindex="-1"></a>    drawnItems<span class="op">.</span><span class="fu">clearLayers</span>()<span class="op">;</span></span>
<span id="cb476-49"><a href="collaborative-mapping.html#cb476-49" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb476-50"><a href="collaborative-mapping.html#cb476-50" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<p>We will now go over the code, step by step.</p>
<p>The first two expressions are exactly the same as in <code>example-13-04.html</code> (Section <a href="collaborative-mapping.html#submission-form">13.5</a>). Again, these two expressions are used to extract the entered text in the name and description fields, as given at the precise moment when the “submit” button was clicked. The name and description values are assigned into variables named <code>enteredUsername</code> and <code>enteredDescription</code>, respectively: </p>
<div class="sourceCode" id="cb477"><pre class="sourceCode js"><code class="sourceCode javascript"><span id="cb477-1"><a href="collaborative-mapping.html#cb477-1" aria-hidden="true" tabindex="-1"></a><span class="kw">let</span> enteredUsername <span class="op">=</span> <span class="bu">document</span><span class="op">.</span><span class="fu">getElementById</span>(<span class="st">&quot;input_name&quot;</span>)<span class="op">.</span><span class="at">value</span><span class="op">;</span></span>
<span id="cb477-2"><a href="collaborative-mapping.html#cb477-2" aria-hidden="true" tabindex="-1"></a><span class="kw">let</span> enteredDescription <span class="op">=</span> <span class="bu">document</span><span class="op">.</span><span class="fu">getElementById</span>(<span class="st">&quot;input_desc&quot;</span>)<span class="op">.</span><span class="at">value</span><span class="op">;</span></span></code></pre></div>
<p>The central code block inside the <code>setData</code> function is contained inside the <code>.eachLayer</code> iteration on <code>drawnItems</code>. As shown in <code>example-13-02.html</code> (Section <a href="collaborative-mapping.html#printing-drawn-items-geojson">13.4.1</a>) and <code>example-13-04.html</code> (Section <a href="collaborative-mapping.html#submission-form">13.5</a>), using <code>.eachLayer</code> we basically apply a function on each of the layers comprising <code>drawnItems</code>. The function has a parameter named <code>layer</code>, which is assigned with the current layer in each step of the iteration: </p>
<div class="sourceCode" id="cb478"><pre class="sourceCode js"><code class="sourceCode javascript"><span id="cb478-1"><a href="collaborative-mapping.html#cb478-1" aria-hidden="true" tabindex="-1"></a>drawnItems<span class="op">.</span><span class="fu">eachLayer</span>(<span class="kw">function</span>(layer) {</span>
<span id="cb478-2"><a href="collaborative-mapping.html#cb478-2" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Doing something with each drawn layer</span></span>
<span id="cb478-3"><a href="collaborative-mapping.html#cb478-3" aria-hidden="true" tabindex="-1"></a>})<span class="op">;</span></span></code></pre></div>
<p>What does the internal function in the <code>.eachLayer</code> iteration do in the present case of <code>example-13-05.html</code>? Three things: </p>
<ul>
<li><strong>Construct</strong> the <code>INSERT</code> query for adding a new record into the <code>beer_sheva</code> table</li>
<li><strong>Send</strong> the query to the CARTO SQL API</li>
<li><strong>Copy</strong> the submitted drawing to the CARTO layer, to display it on the map</li>
</ul>
<p>Here is the code for the first part, the SQL query construction:</p>
<div class="sourceCode" id="cb479"><pre class="sourceCode js"><code class="sourceCode javascript"><span id="cb479-1"><a href="collaborative-mapping.html#cb479-1" aria-hidden="true" tabindex="-1"></a><span class="kw">let</span> drawing <span class="op">=</span> <span class="bu">JSON</span><span class="op">.</span><span class="fu">stringify</span>(layer<span class="op">.</span><span class="fu">toGeoJSON</span>()<span class="op">.</span><span class="at">geometry</span>)<span class="op">;</span></span>
<span id="cb479-2"><a href="collaborative-mapping.html#cb479-2" aria-hidden="true" tabindex="-1"></a><span class="kw">let</span> sql <span class="op">=</span> </span>
<span id="cb479-3"><a href="collaborative-mapping.html#cb479-3" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot;INSERT INTO beer_sheva (the_geom, description, name) &quot;</span> <span class="op">+</span> </span>
<span id="cb479-4"><a href="collaborative-mapping.html#cb479-4" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot;VALUES (ST_SetSRID(ST_GeomFromGeoJSON(&#39;&quot;</span> <span class="op">+</span> </span>
<span id="cb479-5"><a href="collaborative-mapping.html#cb479-5" aria-hidden="true" tabindex="-1"></a>    drawing <span class="op">+</span> <span class="st">&quot;&#39;), 4326), &#39;&quot;</span> <span class="op">+</span> </span>
<span id="cb479-6"><a href="collaborative-mapping.html#cb479-6" aria-hidden="true" tabindex="-1"></a>    enteredDescription <span class="op">+</span> <span class="st">&quot;&#39;, &#39;&quot;</span> <span class="op">+</span> </span>
<span id="cb479-7"><a href="collaborative-mapping.html#cb479-7" aria-hidden="true" tabindex="-1"></a>    enteredUsername <span class="op">+</span> <span class="st">&quot;&#39;)&quot;</span><span class="op">;</span></span>
<span id="cb479-8"><a href="collaborative-mapping.html#cb479-8" aria-hidden="true" tabindex="-1"></a><span class="bu">console</span><span class="op">.</span><span class="fu">log</span>(sql)<span class="op">;</span></span></code></pre></div>
<p>This code section builds the SQL query for sending the currently iterated drawn shape to the database. Basically, instead of a fixed <code>INSERT</code> query, such as the one shown above (<code>'Point 1'</code> created by <code>'Michael'</code>), we are constructing the query <em>dynamically</em>, using the three variables:</p>
<ul>
<li><code>drawing</code>—The GeoJSON string for the current layer, goes into the <code>the_geom</code> column</li>
<li><code>enteredDescription</code>—The description entered into the popup, goes into the <code>description</code> column</li>
<li><code>enteredUsername</code>—The name entered into the popup, goes into the <code>name</code> column</li>
</ul>
<p>The complete query is assigned into a variable named <code>sql</code>. Using <code>console.log</code>, the value of <code>sql</code> is then printed into the console, which is helpful when inspecting our web map for potential problems.</p>
<p>The second part of the code takes care of sending the SQL query contained in <code>sql</code> to CARTO:</p>
<div class="sourceCode" id="cb480"><pre class="sourceCode js"><code class="sourceCode javascript"><span id="cb480-1"><a href="collaborative-mapping.html#cb480-1" aria-hidden="true" tabindex="-1"></a><span class="fu">fetch</span>(url<span class="op">,</span> {</span>
<span id="cb480-2"><a href="collaborative-mapping.html#cb480-2" aria-hidden="true" tabindex="-1"></a>    <span class="dt">method</span><span class="op">:</span> <span class="st">&quot;POST&quot;</span><span class="op">,</span></span>
<span id="cb480-3"><a href="collaborative-mapping.html#cb480-3" aria-hidden="true" tabindex="-1"></a>    <span class="dt">headers</span><span class="op">:</span> {</span>
<span id="cb480-4"><a href="collaborative-mapping.html#cb480-4" aria-hidden="true" tabindex="-1"></a>        <span class="st">&quot;Content-Type&quot;</span><span class="op">:</span> <span class="st">&quot;application/x-www-form-urlencoded&quot;</span></span>
<span id="cb480-5"><a href="collaborative-mapping.html#cb480-5" aria-hidden="true" tabindex="-1"></a>    }<span class="op">,</span></span>
<span id="cb480-6"><a href="collaborative-mapping.html#cb480-6" aria-hidden="true" tabindex="-1"></a>    <span class="dt">body</span><span class="op">:</span> <span class="st">&quot;q=&quot;</span> <span class="op">+</span> <span class="pp">encodeURI</span>(sql)</span>
<span id="cb480-7"><a href="collaborative-mapping.html#cb480-7" aria-hidden="true" tabindex="-1"></a>})</span>
<span id="cb480-8"><a href="collaborative-mapping.html#cb480-8" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">then</span>(<span class="kw">function</span>(response) {</span>
<span id="cb480-9"><a href="collaborative-mapping.html#cb480-9" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> response<span class="op">.</span><span class="fu">json</span>()<span class="op">;</span></span>
<span id="cb480-10"><a href="collaborative-mapping.html#cb480-10" aria-hidden="true" tabindex="-1"></a>    })</span>
<span id="cb480-11"><a href="collaborative-mapping.html#cb480-11" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">then</span>(<span class="kw">function</span>(data) {</span>
<span id="cb480-12"><a href="collaborative-mapping.html#cb480-12" aria-hidden="true" tabindex="-1"></a>        <span class="bu">console</span><span class="op">.</span><span class="fu">log</span>(<span class="st">&quot;Data saved:&quot;</span><span class="op">,</span> data)<span class="op">;</span></span>
<span id="cb480-13"><a href="collaborative-mapping.html#cb480-13" aria-hidden="true" tabindex="-1"></a>    })</span>
<span id="cb480-14"><a href="collaborative-mapping.html#cb480-14" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">catch</span>(<span class="kw">function</span>(error) {</span>
<span id="cb480-15"><a href="collaborative-mapping.html#cb480-15" aria-hidden="true" tabindex="-1"></a>        <span class="bu">console</span><span class="op">.</span><span class="fu">log</span>(<span class="st">&quot;Problem saving the data:&quot;</span><span class="op">,</span> error)<span class="op">;</span></span>
<span id="cb480-16"><a href="collaborative-mapping.html#cb480-16" aria-hidden="true" tabindex="-1"></a>    })<span class="op">;</span></span></code></pre></div>
<p>The query is sent as part of an Ajax <code>POST</code> request, which is something we haven’t used yet. <code>POST</code> requests are more rarely used than <code>GET</code> and a little less convenient to work with (Section <a href="web-servers-1.html#post">5.3.2.3</a>). However, <code>POST</code> requests are more appropriate when <em>sending</em> data to be processed on the server, as opposed to <code>GET</code>, which is mostly used to <em>get</em> data from the server. It is important to note that the CARTO SQL API can accept both <code>GET</code> and <code>POST</code> requests, so the same request can be achieved in both ways. In this case, however, making a <code>POST</code> request is safer because the URL in <code>GET</code> requests is limited in character length. The exact lower limit depends on the browser, but can be as low as <a href="https://stackoverflow.com/questions/417142/what-is-the-maximum-length-of-a-url-in-different-browsers">2048 characters</a>. So, if the user has drawn a very complex geometry which results in a very long GeoJSON string, the resulting <code>GET</code> request may be rejected. In a <code>POST</code> request, the parameters are sent as part of associated <em>data</em>, rather than being part of the URL, which resolves the limitation. </p>
<p>To make a <code>POST</code> request we are going to use the <code>fetch</code> function with slighly modified parameters. Until now, we have been extensively using <code>fetch</code> in Chapters <a href="geojson-1.html#geojson-1">7</a>–<a href="client-side-geoprocessing.html#client-side-geoprocessing">12</a>for making <code>GET</code> requests. As mentioned in Section <a href="geojson-1.html#making-ajax-requests-with-fetch">7.7.3</a>, however, the <code>fetch</code> function can also be used to make <code>POST</code> request. In our case, we need to make a <code>POST</code> request to the URL of the CARTO SQL API (<code>"https://michaeldorman.carto.com/api/v2/sql"</code>), with the sent data being the <code>sql</code> string and the data we expect back from the server being JSON. Finally, we specify what to do when the request is successful (<code>success</code>) or when it fails (<code>error</code>). In this case, we choose to simply print either the <code>"Data saved"</code> or the <code>"Problem saving the data"</code> string in the console. </p>
<p>The third part of the <code>eachLayer</code> iteration, inside our <code>setData</code> function code body, transfers the drawn data to the <code>cartoData</code> layer to display it on the map without reloading the map. Basically, the drawn <code>layer</code> is translated to GeoJSON, combined with the <code>description</code> and <code>name</code> properties, then added on the map with <code>L.geoJSON</code>. Without this part, our drawing would only be sent to the database without being shown on the map, unless we reload the web page: </p>
<div class="sourceCode" id="cb481"><pre class="sourceCode js"><code class="sourceCode javascript"><span id="cb481-1"><a href="collaborative-mapping.html#cb481-1" aria-hidden="true" tabindex="-1"></a><span class="kw">let</span> newData <span class="op">=</span> layer<span class="op">.</span><span class="fu">toGeoJSON</span>()<span class="op">;</span></span>
<span id="cb481-2"><a href="collaborative-mapping.html#cb481-2" aria-hidden="true" tabindex="-1"></a>newData<span class="op">.</span><span class="at">properties</span><span class="op">.</span><span class="at">description</span> <span class="op">=</span> enteredDescription<span class="op">;</span></span>
<span id="cb481-3"><a href="collaborative-mapping.html#cb481-3" aria-hidden="true" tabindex="-1"></a>newData<span class="op">.</span><span class="at">properties</span><span class="op">.</span><span class="at">name</span> <span class="op">=</span> enteredUsername<span class="op">;</span></span>
<span id="cb481-4"><a href="collaborative-mapping.html#cb481-4" aria-hidden="true" tabindex="-1"></a>L<span class="op">.</span><span class="fu">geoJSON</span>(newData<span class="op">,</span> {<span class="dt">onEachFeature</span><span class="op">:</span> addPopup})<span class="op">.</span><span class="fu">addTo</span>(cartoData)<span class="op">;</span></span></code></pre></div>
<p>Finally, outside of the <code>.eachLayer</code> iteration, we close the editable popup and clear the <code>drawnItems</code> feature group. The map is now ready for making a new drawing and sending it to the database. </p>
<div class="sourceCode" id="cb482"><pre class="sourceCode js"><code class="sourceCode javascript"><span id="cb482-1"><a href="collaborative-mapping.html#cb482-1" aria-hidden="true" tabindex="-1"></a>drawnItems<span class="op">.</span><span class="fu">closePopup</span>()<span class="op">;</span></span>
<span id="cb482-2"><a href="collaborative-mapping.html#cb482-2" aria-hidden="true" tabindex="-1"></a>drawnItems<span class="op">.</span><span class="fu">clearLayers</span>()<span class="op">;</span></span></code></pre></div>
<p>The complete crowdsourcing app (<code>example-13-05.html</code>) is shown in Figure <a href="collaborative-mapping.html#fig:example-13-05">13.10</a>. </p>
<div class="figure" style="text-align: center"><span id="fig:example-13-05"></span>
<iframe src="examples/example-13-05.html" width="100%" height="400px">
</iframe>
<p class="caption">
FIGURE 13.10: <code>example-13-05.html</code> <a href="examples/example-13-05.html" title="View the Example" target="_blank">(Click to view this example on its own)</a>
</p>
</div>
</div>
</div>
<div id="exercise-7" class="section level2" number="13.7">
<h2><span class="header-section-number">13.7</span> Exercise</h2>
<ul>
<li>Use the previous guidelines and <code>example-13-05.html</code> to create your own crowdsourcing app:
<ul>
<li>Create a new table for the responses on CARTO.</li>
<li>Run the appropriate SQL query for granting <code>INSERT</code> privileges on your table (Section <a href="collaborative-mapping.html#setting-database-permissions">13.6.1</a>).</li>
<li>Modify the code in <code>example-13-05.html</code> (Section <a href="collaborative-mapping.html#adding-draw-control">13.6.2</a>) to include your CARTO username and table name.</li>
</ul></li>
</ul>

</div>
</div>






<div class="footnotes">
<hr />
<ol start="111">
<li id="fn111"><p>As of March 2019 (<a href="https://wiki.openstreetmap.org/wiki/Planet.osm" class="uri">https://wiki.openstreetmap.org/wiki/Planet.osm</a>).<a href="collaborative-mapping.html#fnref111" class="footnote-back">↩︎</a></p></li>
<li id="fn112"><p>The reason for using an iteration, rather than converting the entire Feature Group into a single GeoJSON, is that each geometry needs to be submitted as a separate entry in the database. This will become clear in our final example (Section <a href="collaborative-mapping.html#adding-draw-control">13.6.2</a>).<a href="collaborative-mapping.html#fnref112" class="footnote-back">↩︎</a></p></li>
<li id="fn113"><p>If necessary, the drawn shapes can always be combined into their <em>multi-</em> counterparts programmatically, using JavaScript code. For example, the <code>turf.combine</code> function from Turf.js (Chapter <a href="client-side-geoprocessing.html#client-side-geoprocessing">12</a>) can be used to combine geometries.<a href="collaborative-mapping.html#fnref113" class="footnote-back">↩︎</a></p></li>
<li id="fn114"><p>Replace <code>beer_sheva_copy_cartodb_id_seq</code> with the exact name that was given in your error message.<a href="collaborative-mapping.html#fnref114" class="footnote-back">↩︎</a></p></li>
<li id="fn115"><p>The <code>L.Control.Draw</code> options were replaced with <code>...</code> to save space, see Section <a href="collaborative-mapping.html#submission-form">13.5</a> for the complete code.<a href="collaborative-mapping.html#fnref115" class="footnote-back">↩︎</a></p></li>
</ol>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="client-side-geoprocessing.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="associated-files.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook/js/app.min.js"></script>
<script src="libs/gitbook/js/lunr.js"></script>
<script src="libs/gitbook/js/clipboard.min.js"></script>
<script src="libs/gitbook/js/plugin-search.js"></script>
<script src="libs/gitbook/js/plugin-sharing.js"></script>
<script src="libs/gitbook/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook/js/plugin-bookdown.js"></script>
<script src="libs/gitbook/js/jquery.highlight.js"></script>
<script src="libs/gitbook/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": null,
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": null,
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": null,
"toc": {
"collapse": "section",
"scroll_highlight": true
},
"toc_depth": 2,
"search": false
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "../../mathjax.rstudio.com/2.7.2/MathJaxb198.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>


<!-- Mirrored from 132.72.155.230:3838/js/collaborative-mapping.html by HTTrack Website Copier/3.x [XR&CO'2014], Mon, 10 Jan 2022 06:49:12 GMT -->
</html>
